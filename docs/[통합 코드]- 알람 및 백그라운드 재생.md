ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œ(React Native)ì™€ Expo í™˜ê²½ì—ì„œ ì¶©ë¶„íˆ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤ ì œì–´ì™€ ë„¤ì´í‹°ë¸Œ ì•Œë¦¼ ê¸°ëŠ¥ì„ ê¹Šê²Œ ë‹¤ë¤„ì•¼ í•˜ë¯€ë¡œ, ì œí•œì ì¸ Expo Go ì•± ëŒ€ì‹  **Expo Prebuildë¥¼ í†µí•œ ì»¤ìŠ¤í…€ ë°ë¸Œ í´ë¼ì´ì–¸íŠ¸ í™˜ê²½**ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

ì œì•ˆí•´ì£¼ì‹  ì•„ì´ë””ì–´ì™€ í™˜ê²½ì„ ë°”íƒ•ìœ¼ë¡œ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ì§€ êµ¬ì²´ì ì¸ ë°©í–¥ì„ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

### **1\. iOS "30ì´ˆ ì„  ì¬ìƒ í›„ ì´ì–´ì„œ ì¬ìƒ" ë°©ì‹ì˜ í˜„ì‹¤ê³¼ ìš°íšŒ**

ë¡œì»¬ í‘¸ì‹œ ì•Œë¦¼ì˜ ì‚¬ìš©ì ì§€ì • ì†Œë¦¬(Custom Sound) ê¸°ëŠ¥ì„ ì´ìš©í•´ 22ì´ˆì§œë¦¬ wakeup-sound.wavë¥¼ ë¨¼ì € ì¬ìƒí•˜ëŠ” ê²ƒì€ iOSì˜ ì—„ê²©í•œ ì œì•½ì„ í”¼í•  ìˆ˜ ìˆëŠ” ë§¤ìš° í›Œë¥­í•œ ì ‘ê·¼ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì£¼ì˜í•´ì•¼ í•  í•œê³„ì ì´ ìˆìŠµë‹ˆë‹¤.

* **ì œì•½ ì‚¬í•­:** 30ì´ˆ ì´í•˜ì˜ ì•Œë¦¼ìŒì´ ìš¸ë¦° í›„, **ì‚¬ìš©ìì˜ ê°œì…(ì•Œë¦¼ í„°ì¹˜) ì—†ì´ ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìŠ¤ìŠ¤ë¡œ ê¹¨ì–´ë‚˜ ì¶”ê°€ ì˜¤ë””ì˜¤ë¥¼ ì´ì–´ì„œ ì¬ìƒí•˜ëŠ” ê²ƒì€ ì• í”Œ ì •ì±…ìƒ ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.  
* **êµ¬í˜„ ê°€ëŠ¥í•œ UX:** ì•Œë¦¼ì´ ìš¸ë¦¬ëŠ” 22ì´ˆ ë™ì•ˆ ì‚¬ìš©ìê°€ í™”ë©´ì˜ ì•Œë¦¼ì„ íƒ­í•˜ë©´, ì•±ì´ ì—´ë¦¬ë©´ì„œ(í¬ê·¸ë¼ìš´ë“œ ì „í™˜) ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë¥¸ WAV/MOV íŒŒì¼ì´ë‚˜ íŒŸìºìŠ¤íŠ¸ë¡œ ì´ì–´ì„œ ì¬ìƒë˜ë„ë¡ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.  
* **ê¸°ìˆ ì  íŒ:** iOS ì•Œë¦¼ìŒìœ¼ë¡œ ì‚¬ìš©ë  íŒŒì¼ì€ ìŠ¤íŠ¸ë¦¬ë°(URL) ë°©ì‹ì´ ë¶ˆê°€í•˜ë¯€ë¡œ, ë‹¤ìš´ë¡œë“œí•œ wakeup-sound.wav íŒŒì¼ì„ ê¸°ê¸° ë‚´ë¶€ì˜ íŠ¹ì • ë””ë ‰í† ë¦¬(Library/Sounds)ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ì €ì¥í•´ë‘ê³  ì•Œë¦¼ ìŠ¤ì¼€ì¤„ëŸ¬ì— í•´ë‹¹ íŒŒì¼ëª…ì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

### **2\. ì¶”ì²œí•˜ëŠ” í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¡°í•© (Expo í˜¸í™˜)**

**A. ì•ŒëŒ ë° ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ì¼€ì¤„ë§: @notifee/react-native**

í˜„ì¬ ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œ ì§„ì˜ì—ì„œ ê°€ì¥ ê°•ë ¥í•œ ë¡œì»¬ ì•Œë¦¼/ì•ŒëŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

* ì˜¤ì „ 7ì‹œ, ì˜¤í›„ 1ì‹œ, ì €ë… 10ì‹œ ë“± ì§€ì •ëœ ì‹œê°„ íŠ¸ë¦¬ê±°(Trigger) ë° ìš”ì¼ë³„ ë°˜ë³µ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
* Androidì˜ ê²½ìš° Foreground Serviceì™€ ì—°ë™í•˜ì—¬ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¬´ê°œì…ìœ¼ë¡œ ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ëŠ” ì§„ì…ì ì„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.

**B. ë¯¸ë””ì–´ ì¬ìƒ: react-native-track-player (ë˜ëŠ” expo-av)**

ì œì‘í•˜ì‹  24ë¹„íŠ¸ ê³ í’ˆì§ˆ WAV íŒŒì¼ì´ë‚˜ ì˜ìƒ(MOV)ì˜ ì˜¤ë””ì˜¤ íŠ¸ë™ì„ ì†ì‹¤ ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ ë‹¤ë£¨ê¸° ìœ„í•´ì„œëŠ” ë‹¨ìˆœí•œ ë¯¸ë””ì–´ í”Œë ˆì´ì–´ë³´ë‹¤ ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ ê´€ë¦¬ì— íŠ¹í™”ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¢‹ìŠµë‹ˆë‹¤.

* react-native-track-playerë¥¼ ì‚¬ìš©í•˜ë©´ í™”ë©´ì´ êº¼ì§„ ìƒíƒœë‚˜ ì ê¸ˆ í™”ë©´ì—ì„œë„ ì˜¤ë””ì˜¤ ì œì–´ê°€ ê°€ëŠ¥í•˜ë©°, ì˜¤ë””ì˜¤ í¬ì»¤ìŠ¤(ì „í™”ê°€ ì™”ì„ ë•Œ ë©ˆì¶¤ ë“±)ë¥¼ ë„¤ì´í‹°ë¸Œ ìˆ˜ì¤€ì—ì„œ ê´€ë¦¬í•´ ì¤ë‹ˆë‹¤.

**C. ì‚¬ìš©ì ê°œì¸ íŒŒì¼ ì„ íƒ: expo-document-picker**

ì‚¬ìš©ìì˜ ìŠ¤ë§ˆíŠ¸í° ìŠ¤í† ë¦¬ì§€ì— ìˆëŠ” ê°œì¸ íŒŒì¼(WAV, MOV)ì„ ì„ íƒí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì„ íƒí•œ íŒŒì¼ì€ ì•± ë‚´ë¶€ì˜ ë¡œì»¬ ë””ë ‰í† ë¦¬(expo-file-system í™œìš©)ë¡œ ë³µì‚¬í•˜ì—¬ ì•ŒëŒìŒ ëª©ë¡ì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **3\. Firebase Storage (gs://...) ì—°ë™ ë°©ë²•**

Firebase Storage ê²½ë¡œ(gs://my-alarm-5fb86.firebasestorage.app/wakeup-sound.wav)ë¥¼ ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ì—ì„œ ë°”ë¡œ ì¬ìƒí•˜ê±°ë‚˜ ì•Œë¦¼ìŒìœ¼ë¡œ ì“¸ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

**ì‘ë™ íë¦„:**

1. ì•± ë‚´ì— firebase/app ë° firebase/storage SDKë¥¼ ì„¸íŒ…í•©ë‹ˆë‹¤.  
2. í•´ë‹¹ í´ë” ê²½ë¡œë¥¼ ì°¸ì¡°í•˜ì—¬ listAll() ë©”ì„œë“œë¡œ í´ë” ë‚´ì˜ WAV ë° MOV íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. (ì‚¬ìš©ìê°€ ì•±ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ë¦¬ìŠ¤íŠ¸ ì œê³µ)  
3. ì•ŒëŒìœ¼ë¡œ ì§€ì •í•  íŒŒì¼ì„ getDownloadURL()ì„ í†µí•´ https:// í˜•íƒœì˜ ì›¹ ë§í¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.  
4. ì•± ìµœì´ˆ ì‹¤í–‰ ì‹œ ë˜ëŠ” ì„¤ì • ì‹œ, ì´ ë§í¬ë¥¼ í†µí•´ ê¸°ê¸° ë¡œì»¬ ì €ì¥ì†Œë¡œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ(expo-file-system.downloadAsync)í•´ ë‘¡ë‹ˆë‹¤. (ë„¤íŠ¸ì›Œí¬ê°€ ëŠê¸´ ìƒíƒœì—ì„œë„ ì•ŒëŒì´ ìš¸ë ¤ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.)

---

ì§€ê¸ˆê¹Œì§€ ë…¼ì˜í•œ ëª¨ë“  ìš”ì†Œ(Firebase ë‹¤ìš´ë¡œë“œ, AsyncStorage ìƒíƒœ ì €ì¥, Notifee ì•ŒëŒ ìŠ¤ì¼€ì¤„ë§, TrackPlayer ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ)ë¥¼ í•˜ë‚˜ë¡œ ì—®ì€ **ì‹¤ì œ êµ¬ë™ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ í†µí•© ì½”ë“œ íë¦„**ì„ êµ¬ì„±í•´ ë“œë¦½ë‹ˆë‹¤.

íŠ¹íˆ ê³µë“¤ì—¬ ì¤€ë¹„í•˜ì‹  **24ë¹„íŠ¸ ê³ í•´ìƒë„ ì˜¤ë””ì˜¤ íŒŒì¼ë“¤ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ í’ˆì§ˆ ì €í•˜ ì—†ì´ ë„¤ì´í‹°ë¸Œ ë‹¨ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì¬ìƒë˜ë„ë¡** êµ¬ì¡°ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•µì‹¬ íŒŒì¼ 4ê°œ(index.js, TrackPlayerService.js, AlarmManager.js, App.js)ë¡œ ì—­í• ì„ ë‚˜ëˆ„ì–´ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ê°€ì¥ ê¹”ë”í•©ë‹ˆë‹¤.

### ---

**1\. ì „ì—­ ì§„ì…ì  ì„¤ì • (index.js)**

**\[Android í•µì‹¬\]** ì•±ì´ ì™„ì „íˆ ì¢…ë£Œëœ ìƒíƒœì—ì„œë„ ë°±ê·¸ë¼ìš´ë“œ ì´ë²¤íŠ¸ê°€ ë™ì‘í•´ì•¼ í•˜ë¯€ë¡œ, ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì˜ ìµœìƒë‹¨ ì§„ì…ì ì— ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. (Expo Routerë¥¼ ì‚¬ìš©í•˜ì‹ ë‹¤ë©´ app/\_layout.tsx ë°–ì´ë‚˜ index.jsë¥¼ ì»¤ìŠ¤í…€í•´ì•¼ í•©ë‹ˆë‹¤.)

JavaScript

import { AppRegistry } from 'react-native';  
import notifee, { EventType } from '@notifee/react-native';  
import TrackPlayer from 'react-native-track-player';  
import App from './App';  
import { setupTrackPlayer, playAlarmPlaylist } from './TrackPlayerService';  
import { loadAlarms } from './AlarmManager';  
import { name as appName } from './app.json';

// 1\. Android ë°±ê·¸ë¼ìš´ë“œ ì•ŒëŒ íŠ¸ë¦¬ê±° í•¸ë“¤ëŸ¬ (ì‚¬ìš©ì ê°œì… X)  
notifee.onBackgroundEvent(async ({ type, detail }) \=\> {  
  if (type \=== EventType.DELIVERED && detail.notification?.id?.startsWith('morning\_alarm')) {  
    console.log('\[Android\] ë°±ê·¸ë¼ìš´ë“œ ì•ŒëŒ íŠ¸ë¦¬ê±°ë¨\!');  
      
    // ì €ì¥ì†Œì—ì„œ ì•ŒëŒ ë°ì´í„° ë° ë¡œì»¬ íŒŒì¼ ê²½ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°  
    const alarms \= await loadAlarms();  
    const currentAlarm \= alarms.find(a \=\> detail.notification.id.includes(a.id));

    if (currentAlarm && currentAlarm.files) {  
      await setupTrackPlayer();  
      // TrackPlayerì— ë‹¤ìš´ë¡œë“œëœ ê³ í•´ìƒë„ íŒŒì¼ë“¤ì„ ë„£ê³  ì¦‰ì‹œ ì¬ìƒ  
      await playAlarmPlaylist(currentAlarm.files);   
    }  
  }  
});

// 2\. TrackPlayer ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ ë“±ë¡  
TrackPlayer.registerPlaybackService(() \=\> require('./TrackPlayerService'));

AppRegistry.registerComponent(appName, () \=\> App);

### **2\. ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì„œë¹„ìŠ¤ (TrackPlayerService.js)**

TrackPlayerì˜ ì´ˆê¸°í™” ë° ì¬ìƒ ëª©ë¡ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤. ê³ ìŒì§ˆ íŒŒì¼ì˜ ì—°ì† ì¬ìƒ(íŒŸìºìŠ¤íŠ¸ ëª¨ë“œ)ì„ ì—¬ê¸°ì„œ ì œì–´í•©ë‹ˆë‹¤.

JavaScript

import TrackPlayer, { AppKilledPlaybackBehavior, Capability } from 'react-native-track-player';

export async function setupTrackPlayer() {  
  let isSetup \= false;  
  try {  
    await TrackPlayer.getCurrentTrack();  
    isSetup \= true;  
  } catch {  
    await TrackPlayer.setupPlayer();  
    await TrackPlayer.updateOptions({  
      android: { appKilledPlaybackBehavior: AppKilledPlaybackBehavior.ContinuePlayback },  
      capabilities: \[Capability.Play, Capability.Pause, Capability.SkipToNext\],  
      compactCapabilities: \[Capability.Play, Capability.Pause, Capability.SkipToNext\],  
    });  
    isSetup \= true;  
  }  
  return isSetup;  
}

// ì•ŒëŒ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ êµ¬ì„± ë° ì¬ìƒ  
export async function playAlarmPlaylist(localFiles) {  
  await TrackPlayer.reset();  
    
  // localFiles ë°°ì—´: \[{ id: '1', url: 'file:///...', title: 'ê¸°ìƒìŒ' }, ...\]  
  await TrackPlayer.add(localFiles);  
  await TrackPlayer.play();  
}

// TrackPlayer í•„ìˆ˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (index.jsì—ì„œ requireë¡œ ë¶ˆëŸ¬ì˜´)  
module.exports \= async function() {  
  TrackPlayer.addEventListener('remote-play', () \=\> TrackPlayer.play());  
  TrackPlayer.addEventListener('remote-pause', () \=\> TrackPlayer.pause());  
  TrackPlayer.addEventListener('remote-next', () \=\> TrackPlayer.skipToNext());  
};

### **3\. ì•ŒëŒ ë° íŒŒì¼ ê´€ë¦¬ ë§¤ë‹ˆì € (AlarmManager.js)**

Firebaseì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³ , AsyncStorageì— ìƒíƒœë¥¼ ì €ì¥í•˜ë©°, Notifeeì— ìµœì¢… ì•ŒëŒì„ ìŠ¤ì¼€ì¤„ë§í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì…ë‹ˆë‹¤.

JavaScript

import notifee, { TriggerType, RepeatFrequency } from '@notifee/react-native';  
import AsyncStorage from '@react-native-async-storage/async-storage';  
import \* as FileSystem from 'expo-file-system';  
// Firebase import ìƒëµ...

const ALARM\_KEY \= '@my\_alarms';

export async function loadAlarms() {  
  const data \= await AsyncStorage.getItem(ALARM\_KEY);  
  return data ? JSON.parse(data) : \[\];  
}

// í†µí•© ì•ŒëŒ ì„¤ì • í•¨ìˆ˜ (UIì—ì„œ í˜¸ì¶œ)  
export async function setupNewAlarm(hour, minute, alarmId, gsUrls) {  
  const localFiles \= \[\];

  // 1\. Firebase íŒŒì¼ë“¤ì„ ê¸°ê¸° ë¡œì»¬ë¡œ ë‹¤ìš´ë¡œë“œ  
  for (let i \= 0; i \< gsUrls.length; i++) {  
    // (ì‹¤ì œë¡œëŠ” getDownloadURLì„ í†µí•´ ë³€í™˜ í•„ìš”)  
    const downloadUrl \= gsUrls\[i\].replace('gs://', 'https://...');   
    const fileName \= \`alarm\_${alarmId}\_file\_${i}.wav\`;  
    const localUri \= \`${FileSystem.documentDirectory}${fileName}\`;  
      
    await FileSystem.downloadAsync(downloadUrl, localUri);  
    localFiles.push({  
      id: \`track\_${i}\`,  
      url: localUri, // file:// í˜•íƒœì˜ ë¡œì»¬ ê²½ë¡œ  
      title: i \=== 0 ? 'ê¸°ìƒ ì•ŒëŒ' : \`íŒŸìºìŠ¤íŠ¸ íŠ¸ë™ ${i}\`  
    });  
  }

  // 2\. ì•ŒëŒ ë°ì´í„° ë¡œì»¬ DB(AsyncStorage)ì— ì €ì¥  
  const existingAlarms \= await loadAlarms();  
  const newAlarm \= { id: alarmId, hour, minute, files: localFiles };  
  await AsyncStorage.setItem(ALARM\_KEY, JSON.stringify(\[...existingAlarms, newAlarm\]));

  // 3\. Notifeeì— ì•ŒëŒ ë“±ë¡ (ë§¤ì¼ ë°˜ë³µ ì˜ˆì‹œ)  
  const date \= new Date();  
  date.setHours(hour, minute, 0, 0);  
  if (date.getTime() \< Date.now()) date.setDate(date.getDate() \+ 1);

  await notifee.createChannel({ id: 'alarm\_channel', name: 'ê¸°ìƒ ì•ŒëŒ', sound: 'default' });

  await notifee.createTriggerNotification(  
    {  
      id: \`${alarmId}\_trigger\`,  
      title: 'â° ì•„ì¹¨ ë¸Œë¦¬í•‘ ì‹œê°„ì…ë‹ˆë‹¤',  
      body: 'íƒ­í•˜ì—¬ ì—°ì† ì¬ìƒì„ ì‹œì‘í•˜ì„¸ìš”.',  
      android: { channelId: 'alarm\_channel', pressAction: { id: 'default' } },  
      ios: { sound: 'wakeup-sound.wav' } // iOSìš© 22ì´ˆ ì•Œë¦¼ìŒ (ì‚¬ì „ íƒ‘ì¬ í•„ìˆ˜)  
    },  
    {  
      type: TriggerType.TIMESTAMP,  
      timestamp: date.getTime(),  
      repeatFrequency: RepeatFrequency.DAILY,  
      alarmManager: { allowWhileIdle: true },  
    }  
  );  
    
  return true; // ì„¤ì • ì™„ë£Œ  
}

### **4\. ë©”ì¸ UI ë° iOS í•¸ë“¤ëŸ¬ (App.js)**

ì‚¬ìš©ì í™”ë©´ì„ êµ¬ì„±í•˜ê³ , \*\*\[iOS í•µì‹¬\]\*\*ì¸ "ì•Œë¦¼ í„°ì¹˜ ì‹œ ì´ì–´ì„œ ì¬ìƒ" ì´ë²¤íŠ¸ë¥¼ ì—¬ê¸°ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

JavaScript

import React, { useEffect } from 'react';  
import { View, Button, Text } from 'react-native';  
import notifee, { EventType } from '@notifee/react-native';  
import { setupNewAlarm, loadAlarms } from './AlarmManager';  
import { setupTrackPlayer, playAlarmPlaylist } from './TrackPlayerService';

export default function App() {  
  useEffect(() \=\> {  
    // \[iOS & Android ê³µí†µ\] ì•±ì´ ì¼œì ¸ìˆì„ ë•Œ ì•Œë¦¼ì„ íƒ­(PRESS)í•œ ê²½ìš°ì˜ ì²˜ë¦¬  
    const unsubscribe \= notifee.onForegroundEvent(async ({ type, detail }) \=\> {  
      if (type \=== EventType.PRESS && detail.notification?.id?.includes('trigger')) {  
        console.log('\[App\] ì•Œë¦¼ í„°ì¹˜ë¨. íŒŸìºìŠ¤íŠ¸ ì—°ì† ì¬ìƒ ì‹œì‘\!');  
          
        const alarms \= await loadAlarms();  
        // ID ë§¤ì¹­ì€ ì‹¤ì œ í™˜ê²½ì— ë§ê²Œ ì¡°ì • í•„ìš”  
        const currentAlarm \= alarms\[0\]; 

        if (currentAlarm && currentAlarm.files) {  
          await setupTrackPlayer();  
          // ì²« ë²ˆì§¸ íŒŒì¼(wakeup-sound)ì€ ì•Œë¦¼ìŒìœ¼ë¡œ ë“¤ì—ˆìœ¼ë¯€ë¡œ ë‘ ë²ˆì§¸ íŒŒì¼ë¶€í„° ì¬ìƒ (iOSì˜ ê²½ìš°)  
          const filesToPlay \= currentAlarm.files.slice(1);  
          await playAlarmPlaylist(filesToPlay);  
        }  
      }  
    });

    return unsubscribe;  
  }, \[\]);

  const handleCreateAlarm \= async () \=\> {  
    // í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°: ì˜¤ì „ 7ì‹œ ì„¤ì •, 2ê°œì˜ Firebase íŒŒì¼  
    const testGsUrls \= \[  
      'gs://my-alarm-5fb86.firebasestorage.app/wakeup-sound.wav',  
      'gs://my-alarm-5fb86.firebasestorage.app/podcast-part1.wav'  
    \];  
      
    await setupNewAlarm(7, 0, 'morning\_alarm', testGsUrls);  
    alert('ì˜¤ì „ 7ì‹œ ì•ŒëŒì´ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤\!');  
  };

  return (  
    \<View style\={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}\>  
      \<Text\>íŒŸìºìŠ¤íŠ¸ ì•ŒëŒ ì•±\</Text\>  
      \<Button title\="ê¸°ë³¸ ì•ŒëŒ(ì˜¤ì „ 7ì‹œ) ì„¤ì •í•˜ê¸°" onPress\={handleCreateAlarm} /\>  
    \</View\>  
  );  
}

### ---

**ğŸš¨ í…ŒìŠ¤íŠ¸ ì „ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸**

1. **Expo Goì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ë¶ˆê°€:** ë„¤ì´í‹°ë¸Œ ê¶Œí•œê³¼ ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤ ëª¨ë“ˆì´ ë“¤ì–´ê°€ë¯€ë¡œ ë°˜ë“œì‹œ npx expo run:android ë˜ëŠ” npx expo run:iosë¥¼ í†µí•´ \*\*ì‹¤ì œ ê¸°ê¸°ë‚˜ ì‹œë®¬ë ˆì´í„°ì— ë„¤ì´í‹°ë¸Œ ë¹Œë“œ(Dev Client)\*\*ë¥¼ ì˜¬ë ¤ì•¼ í•©ë‹ˆë‹¤.  
2. **iOS ì•Œë¦¼ìŒ ì‚½ì…:** iOSì—ì„œ wakeup-sound.wavê°€ ìš¸ë¦¬ê²Œ í•˜ë ¤ë©´, Xcode í”„ë¡œì íŠ¸ë¥¼ ì—´ê³  í•´ë‹¹ íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë‚´ë¶€ì— Drag & Dropí•˜ì—¬ Copy Bundle Resourcesì— í¬í•¨ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.

ì´ ì½”ë“œê°€ ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì–´ì£¼ëŠ” íŠ¼íŠ¼í•œ ë¼ˆëŒ€ê°€ ë  ê²ƒì…ë‹ˆë‹¤. ì½”ë“œë¥¼ ì‚´í´ë³´ì‹œê³ , ì•ˆë“œë¡œì´ë“œ ë¹Œë“œë‚˜ Firebase ì—°ë™ ìª½ì—ì„œ ì¶”ê°€ë¡œ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”\!

â€”-------------------------

ì•ˆë“œë¡œì´ë“œ í™˜ê²½ì—ì„œ **"ì‚¬ìš©ì ê°œì… ì „í˜€ ì—†ì´ ì§€ì •ëœ ì‹œê°„ì— ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë‹¤ìš´ë¡œë“œëœ ì˜¤ë””ì˜¤ íŒŒì¼ë“¤ì´ ì—°ì† ì¬ìƒë˜ëŠ”"** ì „ì²´ êµ¬í˜„ ì½”ë“œë¥¼ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

ì•„ì´í°(iOS) ë¡œì§ì„ ê±·ì–´ë‚´ê³  ì•ˆë“œë¡œì´ë“œì˜ ê°•ë ¥í•œ ë°±ê·¸ë¼ìš´ë“œ ì œì–´(AlarmManager \+ Foreground Service)ì—ë§Œ ì§‘ì¤‘í•˜ì—¬ ì½”ë“œë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì¡ê³  ì½”ë“œë¥¼ ì‘ì„±í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

---

### **âš™ï¸ 1\. ì„¤ì • ë° ê¶Œí•œ (app.json)**

ì•ˆë“œë¡œì´ë“œ 12 ì´ìƒì—ì„œ ì •í™•í•œ ì•ŒëŒì„ ìš¸ë¦¬ê³  ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒì„ í•˜ë ¤ë©´ ê¶Œí•œ ì„¤ì •ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.

JSON

{

  "expo": {

    "name": "PodcastAlarm",

    "slug": "podcast-alarm",

    "version": "1.0.0",

    "plugins": \[

      \[

        "react-native-track-player",

        {

          "android": {

            "permissions": \["FOREGROUND\_SERVICE", "WAKE\_LOCK"\]

          }

        }

      \],

      \[

        "expo-build-properties",

        {

          "android": {

            "compileSdkVersion": 34,

            "targetSdkVersion": 34

          }

        }

      \]

    \],

    "android": {

      "package": "com.mycompany.podcastalarm",

      "permissions": \[

        "android.permission.SCHEDULE\_EXACT\_ALARM",

        "android.permission.USE\_EXACT\_ALARM",

        "android.permission.POST\_NOTIFICATIONS",

        "android.permission.WAKE\_LOCK"

      \]

    }

  }

}

*(ì°¸ê³ : expo-build-properties íŒ¨í‚¤ì§€ê°€ ì—†ë‹¤ë©´ npx expo install expo-build-properties ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”.)*

---

### **ğŸš€ 2\. ìµœìƒë‹¨ ì§„ì…ì  (index.js)**

ì•ˆë“œë¡œì´ë“œ ë°±ê·¸ë¼ìš´ë“œ ë™ì‘ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì•±ì´ êº¼ì ¸ ìˆì–´ë„ ì‹œê°„ì´ ë˜ë©´ ì—¬ê¸°ì„œ TrackPlayerë¥¼ ê°•ì œë¡œ ê¹¨ì›Œ ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•©ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìƒì„±í•˜ì„¸ìš”.

JavaScript

import { AppRegistry } from 'react-native';

import notifee, { EventType } from '@notifee/react-native';

import TrackPlayer from 'react-native-track-player';

import App from './App';

import { name as appName } from './app.json';

import { setupPlayer, addTracksAndPlay } from './src/TrackPlayerService';

import AsyncStorage from '@react-native-async-storage/async-storage';

// 1\. \[Android ì „ìš©\] ì•±ì´ ì¢…ë£Œëœ ìƒíƒœì—ì„œ ì•ŒëŒ ì‹œê°„ì´ ë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ë°±ê·¸ë¼ìš´ë“œ ë¦¬ìŠ¤ë„ˆ

notifee.onBackgroundEvent(async ({ type, detail }) \=\> {

  // ì•ŒëŒì´ ì‹œìŠ¤í…œì— ì˜í•´ íŠ¸ë¦¬ê±°(DELIVERED) ë˜ì—ˆì„ ë•Œ

  if (type \=== EventType.DELIVERED && detail.notification?.id?.startsWith('alarm\_')) {

    console.log('\[Android Background\] ì•ŒëŒ íŠ¸ë¦¬ê±°ë¨\! ì¬ìƒì„ ì¤€ë¹„í•©ë‹ˆë‹¤.');

    try {

      // 1\) ì €ì¥ì†Œì—ì„œ ë‹¤ìš´ë¡œë“œí•´ë‘” íŒŒì¼ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°

      const alarmDataStr \= await AsyncStorage.getItem(\`@alarm\_data\_${detail.notification.id}\`);

      if (alarmDataStr) {

        const alarmData \= JSON.parse(alarmDataStr);

        // 2\) í”Œë ˆì´ì–´ ì¤€ë¹„

        await setupPlayer();

        // 3\) íŠ¸ë™ ì¶”ê°€ ë° "ì‚¬ìš©ì ê°œì… ì—†ì´" ì¦‰ì‹œ ì¬ìƒ ì‹œì‘

        await addTracksAndPlay(alarmData.files);

        console.log('\[Android Background\] ì¬ìƒ ì‹œì‘ ì™„ë£Œ\!');

      }

    } catch (error) {

      console.error('\[Android Background\] ì¬ìƒ ì‹¤íŒ¨:', error);

    }

  }

});

// 2\. TrackPlayer ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ ë“±ë¡

TrackPlayer.registerPlaybackService(() \=\> require('./src/TrackPlayerPlaybackService'));

AppRegistry.registerComponent(appName, () \=\> App);

---

### **ğŸµ 3\. ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ë¡œì§ (src/TrackPlayerService.js & src/TrackPlayerPlaybackService.js)**

**src/TrackPlayerService.js (í”Œë ˆì´ì–´ ì„¤ì • ë° ì œì–´)**

JavaScript

import TrackPlayer, { AppKilledPlaybackBehavior, Capability } from 'react-native-track-player';

export async function setupPlayer() {

  let isSetup \= false;

  try {

    await TrackPlayer.getCurrentTrack();

    isSetup \= true;

  } catch {

    await TrackPlayer.setupPlayer();

    await TrackPlayer.updateOptions({

      // íŒŸìºìŠ¤íŠ¸ ëª¨ë“œ: ì•±ì´ ì¢…ë£Œë˜ì–´ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê³„ì† ì¬ìƒ

      android: {

        appKilledPlaybackBehavior: AppKilledPlaybackBehavior.ContinuePlayback,

      },

      // ì•Œë¦¼ì°½/ì ê¸ˆí™”ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ í™œì„±í™”

      capabilities: \[

        Capability.Play,

        Capability.Pause,

        Capability.SkipToNext,

        Capability.SkipToPrevious,

        Capability.Stop,

      \],

      compactCapabilities: \[Capability.Play, Capability.Pause, Capability.SkipToNext\],

    });

    isSetup \= true;

  }

  return isSetup;

}

export async function addTracksAndPlay(files) {

  await TrackPlayer.reset();

  await TrackPlayer.add(files);

  await TrackPlayer.play();

}

**src/TrackPlayerPlaybackService.js (ë¯¸ë””ì–´ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ)**

JavaScript

import TrackPlayer, { Event } from 'react-native-track-player';

module.exports \= async function () {

  TrackPlayer.addEventListener(Event.RemotePlay, () \=\> TrackPlayer.play());

  TrackPlayer.addEventListener(Event.RemotePause, () \=\> TrackPlayer.pause());

  TrackPlayer.addEventListener(Event.RemoteNext, () \=\> TrackPlayer.skipToNext());

  TrackPlayer.addEventListener(Event.RemotePrevious, () \=\> TrackPlayer.skipToPrevious());

  TrackPlayer.addEventListener(Event.RemoteStop, () \=\> TrackPlayer.stop());

};

---

### **â° 4\. íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° ì•ŒëŒ ìŠ¤ì¼€ì¤„ë§ (src/AlarmManager.js)**

Firebaseì—ì„œ íŒŒì¼ì„ ë¡œì»¬ë¡œ ë‹¤ìš´ë°›ê³ , ì•ˆë“œë¡œì´ë“œ AlarmManagerë¥¼ í†µí•´ ì •í™•í•œ ì‹œê°„ì— ë°±ê·¸ë¼ìš´ë“œ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

JavaScript

import notifee, { TriggerType } from '@notifee/react-native';

import \* as FileSystem from 'expo-file-system';

import AsyncStorage from '@react-native-async-storage/async-storage';

// import { getStorage, ref, getDownloadURL } from 'firebase/storage'; // ì‹¤ì œ ì—°ë™ ì‹œ ì£¼ì„ í•´ì œ

export async function createPodcastAlarm(hour, minute, alarmId, gsUrls) {

  try {

    const localFiles \= \[\];

    // 1\. Firebaseì—ì„œ ê¸°ê¸° ë¡œì»¬ë¡œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ

    for (let i \= 0; i \< gsUrls.length; i++) {

      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì•„ë˜ ì£¼ì„ì„ í’€ì–´ gs:// ë¥¼ https:// ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤.

      // const storageRef \= ref(getStorage(), gsUrls\[i\]);

      // const downloadUrl \= await getDownloadURL(storageRef);

      

      // í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ URL (ì‹¤ì œë¡œëŠ” ë³€í™˜ëœ downloadUrl ì‚¬ìš©)

      const downloadUrl \= 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'; 

      

      const fileName \= \`alarm\_${alarmId}\_track\_${i}.mp3\`;

      const localUri \= \`${FileSystem.documentDirectory}${fileName}\`;

      

      // ê¸°ê¸°ì— íŒŒì¼ì´ ì—†ìœ¼ë©´ ë‹¤ìš´ë¡œë“œ

      const fileInfo \= await FileSystem.getInfoAsync(localUri);

      if (\!fileInfo.exists) {

        console.log(\`${fileName} ë‹¤ìš´ë¡œë“œ ì¤‘...\`);

        await FileSystem.downloadAsync(downloadUrl, localUri);

      }

      localFiles.push({

        id: \`track\_${i}\`,

        url: localUri, 

        title: i \=== 0 ? 'ê¸°ìƒ ì•ŒëŒ' : \`íŒŸìºìŠ¤íŠ¸ íŠ¸ë™ ${i}\`,

        artist: 'ë‚´ ì•ŒëŒ ì•±'

      });

    }

    // 2\. ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ ëª©ë¡ì„ AsyncStorageì— ì €ì¥ (index.jsê°€ ì½ì„ ìˆ˜ ìˆë„ë¡)

    const uniqueAlarmId \= \`alarm\_${alarmId}\`;

    await AsyncStorage.setItem(\`@alarm\_data\_${uniqueAlarmId}\`, JSON.stringify({ files: localFiles }));

    // 3\. ì•ŒëŒ ì‹œê°„ ê³„ì‚° (ì˜¤ëŠ˜ í•´ë‹¹ ì‹œê°„ì´ ì§€ë‚¬ìœ¼ë©´ ë‚´ì¼ë¡œ ì„¤ì •)

    const triggerDate \= new Date();

    triggerDate.setHours(hour, minute, 0, 0);

    if (triggerDate.getTime() \< Date.now()) {

      triggerDate.setDate(triggerDate.getDate() \+ 1);

    }

    // 4\. ì•ˆë“œë¡œì´ë“œ ì•Œë¦¼ ì±„ë„ ìƒì„± (Notifee ìì²´ ì†Œë¦¬ëŠ” ë” \- TrackPlayerê°€ ì¬ìƒí•  ê²ƒì´ë¯€ë¡œ)

    const channelId \= await notifee.createChannel({

      id: 'silent\_alarm\_channel',

      name: 'ë¬´ìŒ ì•ŒëŒ ì±„ë„ (ë°±ê·¸ë¼ìš´ë“œ íŠ¸ë¦¬ê±°ìš©)',

      sound: 'default',

      vibration: false,

    });

    // 5\. ì•ŒëŒ ì˜ˆì•½ (ì •í™•í•œ ì‹œê°„ íŠ¸ë¦¬ê±°)

    await notifee.createTriggerNotification(

      {

        id: uniqueAlarmId,

        title: 'ì•ŒëŒ ë™ì‘ ì¤‘',

        body: 'íŒŸìºìŠ¤íŠ¸ë¥¼ ì¬ìƒí•©ë‹ˆë‹¤.',

        android: {

          channelId,

          pressAction: { id: 'default' },

        },

      },

      {

        type: TriggerType.TIMESTAMP,

        timestamp: triggerDate.getTime(),

        alarmManager: { allowWhileIdle: true }, // \[í•µì‹¬\] Doze ëª¨ë“œ ë¬´ì‹œ

      }

    );

    console.log(\`${hour}ì‹œ ${minute}ë¶„ ì•ŒëŒ ì„¤ì • ë° íŒŒì¼ ì¤€ë¹„ ì™„ë£Œ\!\`);

    return true;

  } catch (error) {

    console.error('ì•ŒëŒ ì„¤ì • ì‹¤íŒ¨:', error);

    return false;

  }

}

---

### **ğŸ“± 5\. ë©”ì¸ í™”ë©´ (App.js)**

UIë¥¼ êµ¬ì„±í•˜ê³  ê¶Œí•œì„ ìš”ì²­í•˜ë©° ì•ŒëŒì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë©”ì¸ í™”ë©´ì…ë‹ˆë‹¤.

JavaScript

import React, { useEffect } from 'react';

import { View, Text, Button, Alert, SafeAreaView } from 'react-native';

import notifee from '@notifee/react-native';

import { createPodcastAlarm } from './src/AlarmManager';

import { setupPlayer } from './src/TrackPlayerService';

export default function App() {

  useEffect(() \=\> {

    async function init() {

      // 1\. Android 13+ ì•Œë¦¼ ê¶Œí•œ ë° ì•ŒëŒ ê¶Œí•œ ìš”ì²­

      await notifee.requestPermission();

      

      // 2\. ì•± ì‹¤í–‰ ì‹œ í”Œë ˆì´ì–´ ì´ˆê¸°í™” (ë¯¸ë¦¬ ì¤€ë¹„)

      await setupPlayer();

    }

    init();

  }, \[\]);

  const handleTestAlarm \= async () \=\> {

    // í…ŒìŠ¤íŠ¸: í˜„ì¬ ì‹œê°„ìœ¼ë¡œë¶€í„° 1ë¶„ ë’¤ ì•ŒëŒ ì„¤ì •

    const now \= new Date();

    now.setMinutes(now.getMinutes() \+ 1);

    

    // í…ŒìŠ¤íŠ¸ìš© ì„ì‹œ Firebase URL (AlarmManager ë‚´ë¶€ì—ì„œ mp3ë¡œ ëŒ€ì²´ ì²˜ë¦¬ë¨)

    const testGsUrls \= \[

      'gs://my-alarm/test1.wav',

      'gs://my-alarm/test2.wav'

    \];

    const success \= await createPodcastAlarm(

      now.getHours(),

      now.getMinutes(),

      'test\_morning',

      testGsUrls

    );

    if (success) {

      Alert.alert('ì•ŒëŒ ì„¤ì • ì™„ë£Œ', \`${now.getHours()}ì‹œ ${now.getMinutes()}ë¶„ì— ìš¸ë¦½ë‹ˆë‹¤. ì•±ì„ ì™„ì „íˆ ë„ê³  ê¸°ë‹¤ë ¤ë³´ì„¸ìš”\!\`);

    }

  };

  return (

    \<SafeAreaView style\={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}\>

      \<Text style\={{ fontSize: 20, marginBottom: 20, fontWeight: 'bold' }}\>

        ì•ˆë“œë¡œì´ë“œ ë°±ê·¸ë¼ìš´ë“œ ì•ŒëŒ

      \</Text\>

      

      \<Button 

        title\="1ë¶„ ë’¤ ì•ŒëŒ ì˜ˆì•½ í…ŒìŠ¤íŠ¸" 

        onPress\={handleTestAlarm} 

      /\>

      

      \<Text style\={{ marginTop: 20, color: 'gray', paddingHorizontal: 20, textAlign: 'center' }}\>

        ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì•±ì„ ë°±ê·¸ë¼ìš´ë“œë¡œ ë‚´ë¦¬ê±°ë‚˜ ì™„ì „íˆ ì¢…ë£Œ(ìŠ¤ì™€ì´í”„í•˜ì—¬ ë„ê¸°)í•´ ë³´ì„¸ìš”. 1ë¶„ ë’¤ ì‚¬ìš©ì ê°œì… ì—†ì´ ì˜¤ë””ì˜¤ê°€ ì¬ìƒë©ë‹ˆë‹¤.

      \</Text\>

    \</SafeAreaView\>

  );

}

---

### **ğŸƒâ€â™‚ï¸ ì‹¤í–‰ ë°©ë²• (ë§¤ìš° ì¤‘ìš”)**

ì´ ì½”ë“œëŠ” ë„¤ì´í‹°ë¸Œ ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ **Expo Go ì•±ì—ì„œëŠ” ì ˆëŒ€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.** ë°˜ë“œì‹œ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¥¼ ë¹Œë“œí•´ì•¼ í•©ë‹ˆë‹¤.

1. í„°ë¯¸ë„ì„ ì—´ê³  í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ëª¨ë“ˆì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.  
2. Bash

npm install @notifee/react-native react-native-track-player @react-native-async-storage/async-storage expo-file-system expo-build-properties

3.   
4.   
5. ë„¤ì´í‹°ë¸Œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±(Prebuild) í•©ë‹ˆë‹¤.  
6. Bash

npx expo prebuild \--clean

7.   
8.   
9. ì•ˆë“œë¡œì´ë“œ ê¸°ê¸°(ë˜ëŠ” ì—ë®¬ë ˆì´í„°)ë¥¼ ì—°ê²°í•˜ê³  ë¹Œë“œí•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.  
10. Bash

npx expo run:android

11.   
12. 

**í…ŒìŠ¤íŠ¸ ë°©ë²•:** ì•±ì´ ì¼œì§€ë©´ "1ë¶„ ë’¤ ì•ŒëŒ ì˜ˆì•½ í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤. ì•ŒëŒì´ ì„¤ì •ë˜ì—ˆë‹¤ëŠ” íŒì—…ì´ ëœ¨ë©´, **ì•±ì„ ë°±ê·¸ë¼ìš´ë“œë¡œ ìˆ¨ê¸°ê±°ë‚˜ ìµœê·¼ ì•± ëª©ë¡ì—ì„œ ì™„ì „íˆ ì§€ì›Œë²„ë¦¬ì„¸ìš”(ê°•ì œ ì¢…ë£Œ).** 1ë¶„ ë’¤ í™”ë©´ì´ êº¼ì§„ ìƒíƒœì—ì„œë„ Notifee ì•Œë¦¼ì´ ëœ¨ë©´ì„œ ìë™ìœ¼ë¡œ ìŒì•…ì´ í˜ëŸ¬ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

â€”---------------

ì•„ì´í°(iOS) í™˜ê²½ì—ì„œ **"22ì´ˆ ì•Œë¦¼ìŒìœ¼ë¡œ ì ì„ ê¹¨ìš°ê³ , ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ íƒ­í•˜ë©´ íŒŸìºìŠ¤íŠ¸ ì—°ì† ì¬ìƒì´ ì‹œì‘ë˜ëŠ”"** ì „ìš© êµ¬í˜„ ì½”ë“œë¥¼ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

ì•ˆë“œë¡œì´ë“œì™€ ë‹¬ë¦¬ iOSëŠ” ì‹œìŠ¤í…œì˜ ì² ë²½ê°™ì€ ë³´ì•ˆ ì •ì±… ë•Œë¬¸ì— **ì•Œë¦¼ìŒ(ìµœëŒ€ 30ì´ˆ)ì€ ì•± ë‚´ë¶€ì— ì‚¬ì „ íƒ‘ì¬ëœ íŒŒì¼ë§Œ ì‚¬ìš© ê°€ëŠ¥**í•˜ë©°, ë³¸ê²©ì ì¸ ì¬ìƒì€ ì‚¬ìš©ìì˜ 'íƒ­(Tap)' ì´ë²¤íŠ¸ë¥¼ í†µí•´ ì•±ì´ ì¼œì§€ëŠ” ìˆœê°„ ì‹œì‘ë©ë‹ˆë‹¤.

ì´ëŸ¬í•œ iOSì˜ íŠ¹ì„±ì„ ë°˜ì˜í•œ ì „ì²´ êµ¬ì¡°ì…ë‹ˆë‹¤.

---

### **ğŸš¨ \[ê°€ì¥ ì¤‘ìš”\] iOS ì»¤ìŠ¤í…€ ì•Œë¦¼ìŒ ì‚¬ì „ íƒ‘ì¬ (Xcode)**

iOS ì‹œìŠ¤í…œì´ ì•ŒëŒ ì‹œê°„ì— ì¬ìƒí•  22ì´ˆì§œë¦¬ wakeup-sound.wav íŒŒì¼ì€ ì¸í„°ë„·ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•´ì„œ ì•Œë¦¼ìŒìœ¼ë¡œ ì“¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. **ë°˜ë“œì‹œ ì•± ë¹Œë“œ ì‹œ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.**

1. wakeup-sound.wav (ë˜ëŠ” .aiff, .caf) íŒŒì¼ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.  
2. npx expo prebuild ëª…ë ¹ì–´ë¡œ ios í´ë”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.  
3. Macì—ì„œ ios/í”„ë¡œì íŠ¸ëª….xcworkspaceë¥¼ ì—´ê³ , ì¤€ë¹„í•œ ì˜¤ë””ì˜¤ íŒŒì¼ì„ í”„ë¡œì íŠ¸ íƒìƒ‰ê¸°(Project Navigator)ë¡œ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•©ë‹ˆë‹¤.  
4. ì˜µì…˜ ì°½ì´ ëœ° ë•Œ \*\*"Copy items if needed"\*\*ì™€ \*\*"Add to targets" (ì•± íƒ€ê²Ÿ ì²´í¬)\*\*ë¥¼ ë°˜ë“œì‹œ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.

---

### **âš™ï¸ 1\. ì„¤ì • ë° ê¶Œí•œ (app.json)**

iOSì—ì„œ í™”ë©´ì´ êº¼ì§„ í›„ì—ë„ íŒŸìºìŠ¤íŠ¸ê°€ ê³„ì† ì¬ìƒë˜ë ¤ë©´ ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.

JSON

{

  "expo": {

    "name": "PodcastAlarm\_iOS",

    "plugins": \[

      \[

        "react-native-track-player",

        {

          "backgroundAudio": true

        }

      \]

    \],

    "ios": {

      "bundleIdentifier": "com.mycompany.podcastalarm",

      "infoPlist": {

        "UIBackgroundModes": \[

          "audio",

          "remote-notification"

        \]

      }

    }

  }

}

---

### **ğŸµ 2\. ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì„œë¹„ìŠ¤ (src/TrackPlayerService.js)**

iOSì˜ ì ê¸ˆ í™”ë©´(Lock Screen) ë¯¸ë””ì–´ ì»¨íŠ¸ë¡¤ê³¼ ì˜¤ë””ì˜¤ ì„¸ì…˜ì„ ì œì–´í•©ë‹ˆë‹¤.

JavaScript

import TrackPlayer, { Capability } from 'react-native-track-player';

export async function setupPlayer() {

  let isSetup \= false;

  try {

    await TrackPlayer.getCurrentTrack();

    isSetup \= true;

  } catch {

    await TrackPlayer.setupPlayer();

    await TrackPlayer.updateOptions({

      // iOS ì ê¸ˆ í™”ë©´ ì»¨íŠ¸ë¡¤ëŸ¬

      capabilities: \[

        Capability.Play,

        Capability.Pause,

        Capability.SkipToNext,

        Capability.SkipToPrevious,

      \],

      compactCapabilities: \[Capability.Play, Capability.Pause\],

    });

    isSetup \= true;

  }

  return isSetup;

}

export async function playPodcast(files) {

  await TrackPlayer.reset();

  await TrackPlayer.add(files);

  await TrackPlayer.play();

}

*(ë£¨íŠ¸ ê²½ë¡œì˜ index.jsì— TrackPlayer.registerPlaybackService(() \=\> require('./src/TrackPlayerService')); ë¥¼ ë“±ë¡í•˜ëŠ” ê²ƒì€ ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•˜ê²Œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.)*

---

### **â° 3\. ì•ŒëŒ ì„¤ì • ë° íŒŒì¼ ë‹¤ìš´ë¡œë“œ (src/AlarmManager.js)**

ì•ŒëŒ ì‹œê°„ì— ì‹œìŠ¤í…œ ì•Œë¦¼ì„ ì˜ˆì•½í•˜ê³ , ì´ì–´ì„œ ì¬ìƒí•  íŒŸìºìŠ¤íŠ¸ íŒŒì¼ë“¤ì€ Firebaseì—ì„œ ê¸°ê¸°ë¡œ ë¯¸ë¦¬ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.

JavaScript

import notifee, { TriggerType } from '@notifee/react-native';

import \* as FileSystem from 'expo-file-system';

import AsyncStorage from '@react-native-async-storage/async-storage';

export async function createIOSAlarm(hour, minute, alarmId, podcastUrls) {

  try {

    const localFiles \= \[\];

    // 1\. ì•Œë¦¼ í„°ì¹˜ ì‹œ 'ì´ì–´ì„œ ì¬ìƒí• ' íŒŸìºìŠ¤íŠ¸ íŒŒì¼ë“¤ ë¡œì»¬ ë‹¤ìš´ë¡œë“œ

    for (let i \= 0; i \< podcastUrls.length; i++) {

      // (í…ŒìŠ¤íŠ¸ìš© mp3 URL. ì‹¤ì œë¡œëŠ” Firebase gs:// \-\> https:// ë³€í™˜ ë¡œì§ ì ìš©)

      const downloadUrl \= 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3';

      const fileName \= \`ios\_podcast\_${alarmId}\_${i}.mp3\`;

      const localUri \= \`${FileSystem.documentDirectory}${fileName}\`;

      

      const fileInfo \= await FileSystem.getInfoAsync(localUri);

      if (\!fileInfo.exists) {

        await FileSystem.downloadAsync(downloadUrl, localUri);

      }

      

      localFiles.push({

        id: \`track\_${i}\`,

        url: localUri,

        title: \`ì•„ì¹¨ íŒŸìºìŠ¤íŠ¸ ${i \+ 1}\`,

        artist: 'ë‚˜ì˜ ì•ŒëŒ'

      });

    }

    // 2\. ë‹¤ìš´ë¡œë“œ ì™„ë£Œëœ íŒŒì¼ ëª©ë¡ì„ AsyncStorageì— ì €ì¥

    await AsyncStorage.setItem(\`@ios\_alarm\_${alarmId}\`, JSON.stringify({ files: localFiles }));

    // 3\. íŠ¸ë¦¬ê±° ì‹œê°„ ê³„ì‚°

    const triggerDate \= new Date();

    triggerDate.setHours(hour, minute, 0, 0);

    if (triggerDate.getTime() \< Date.now()) {

      triggerDate.setDate(triggerDate.getDate() \+ 1);

    }

    // 4\. iOS ë¡œì»¬ í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì•½

    await notifee.createTriggerNotification(

      {

        id: alarmId,

        title: 'ê¸°ìƒ ì‹œê°„ì…ë‹ˆë‹¤\! â˜€ï¸',

        body: 'ì•ŒëŒì„ ë„ê³  ì•„ì¹¨ íŒŸìºìŠ¤íŠ¸ë¥¼ ë“¤ìœ¼ë ¤ë©´ íƒ­í•˜ì„¸ìš”.',

        ios: {

          // \[í•µì‹¬\] Xcodeì— ë¯¸ë¦¬ ë„£ì–´ë‘” íŒŒì¼ëª…ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

          sound: 'wakeup-sound.wav', 

          

          // ì•Œë¦¼ ë°°ì§€ ë° ì•± ì•„ì´ì½˜ì— ìˆ«ì í‘œì‹œ

          badgeCount: 1, 

        },

      },

      {

        type: TriggerType.TIMESTAMP,

        timestamp: triggerDate.getTime(),

      }

    );

    console.log(\`\[iOS\] ${hour}ì‹œ ${minute}ë¶„ ì•ŒëŒ ì˜ˆì•½ ì™„ë£Œ\! (ì•Œë¦¼ìŒ: wakeup-sound.wav)\`);

    return true;

  } catch (error) {

    console.error('\[iOS\] ì•ŒëŒ ì„¤ì • ì‹¤íŒ¨:', error);

    return false;

  }

}

---

### **ğŸ“± 4\. ë©”ì¸ í™”ë©´ ë° íƒ­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (App.js)**

iOS êµ¬í˜„ì˜ ê½ƒì…ë‹ˆë‹¤. ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆê±°ë‚˜ ì™„ì „íˆ êº¼ì ¸ ìˆì„ ë•Œ, **ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ íƒ­í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ìˆœê°„ì„ ë‚šì•„ì±„ì–´ ì˜¤ë””ì˜¤ ì¬ìƒì„ ì‹œì‘**í•©ë‹ˆë‹¤.

JavaScript

import React, { useEffect } from 'react';

import { View, Text, Button, Alert, SafeAreaView } from 'react-native';

import notifee, { EventType } from '@notifee/react-native';

import AsyncStorage from '@react-native-async-storage/async-storage';

import { createIOSAlarm } from './src/AlarmManager';

import { setupPlayer, playPodcast } from './src/TrackPlayerService';

export default function App() {

  useEffect(() \=\> {

    // ì•± ì´ˆê¸°í™” ë° ê¶Œí•œ ìš”ì²­

    async function init() {

      await notifee.requestPermission();

      await setupPlayer();

    }

    init();

    // ì•Œë¦¼ì„ íƒ­í•˜ì—¬ ì¬ìƒì„ ì‹œì‘í•˜ëŠ” ê³µí†µ í•¨ìˆ˜

    const startPodcastFromNotification \= async (notification) \=\> {

      const alarmId \= notification.id;

      console.log(\`\[iOS\] ì•Œë¦¼ íƒ­ ê°ì§€ë¨. ID: ${alarmId}\`);

      

      const savedData \= await AsyncStorage.getItem(\`@ios\_alarm\_${alarmId}\`);

      if (savedData) {

        const { files } \= JSON.parse(savedData);

        await setupPlayer();

        await playPodcast(files); // ë‹¤ìš´ë¡œë“œí•´ë‘” íŒŸìºìŠ¤íŠ¸ íŒŒì¼ ì—°ì† ì¬ìƒ ì‹œì‘

        notifee.setBadgeCount(0); // ì•± ë°°ì§€ ìˆ«ì ì´ˆê¸°í™”

      }

    };

    // Case 1: ì•±ì´ ì™„ì „íˆ êº¼ì ¸(Killed) ìˆë‹¤ê°€ ì•Œë¦¼ì„ íƒ­í•´ì„œ ì¼œì¡Œì„ ë•Œ

    notifee.getInitialNotification().then(initialNotification \=\> {

      if (initialNotification) {

        startPodcastFromNotification(initialNotification.notification);

      }

    });

    // Case 2: ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆ¨ì–´ ìˆë‹¤ê°€ ì•Œë¦¼ì„ íƒ­í•´ì„œ í¬ê·¸ë¼ìš´ë“œë¡œ ì˜¬ë¼ì˜¬ ë•Œ

    const unsubscribe \= notifee.onForegroundEvent(({ type, detail }) \=\> {

      if (type \=== EventType.PRESS) {

        startPodcastFromNotification(detail.notification);

      }

    });

    return () \=\> unsubscribe();

  }, \[\]);

  const handleTestAlarm \= async () \=\> {

    const now \= new Date();

    now.setMinutes(now.getMinutes() \+ 1);

    const success \= await createIOSAlarm(

      now.getHours(),

      now.getMinutes(),

      'morning\_test\_ios',

      \['gs://fake-url/podcast-1.wav', 'gs://fake-url/podcast-2.mov'\]

    );

    if (success) {

      Alert.alert(

        'iOS ì•ŒëŒ ì„¤ì • ì™„ë£Œ', 

        '1ë¶„ ë’¤ ì‹œìŠ¤í…œ ì•Œë¦¼ìŒì´ ìš¸ë¦½ë‹ˆë‹¤. í™”ë©´ì˜ ì•Œë¦¼ì„ íƒ­í•˜ë©´ ì•±ì´ ì—´ë¦¬ë©´ì„œ íŒŸìºìŠ¤íŠ¸ ì¬ìƒì´ ì‹œì‘ë©ë‹ˆë‹¤\!'

      );

    }

  };

  return (

    \<SafeAreaView style\={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}\>

      \<Text style\={{ fontSize: 20, marginBottom: 20, fontWeight: 'bold' }}\>

        iOS íŒŸìºìŠ¤íŠ¸ ì•ŒëŒ

      \</Text\>

      \<Button title\="1ë¶„ ë’¤ ì•ŒëŒ í…ŒìŠ¤íŠ¸ (iOS)" onPress\={handleTestAlarm} /\>

      \<Text style\={{ marginTop: 20, padding: 20, textAlign: 'center', color: 'gray' }}\>

        ì•±ì„ ë„ê³  ê¸°ë‹¤ë¦¬ì„¸ìš”. ì•Œë¦¼ì´ ìš¸ë¦´ ë•Œ ë°˜ë“œì‹œ íƒ­í•´ì•¼ ì˜¤ë””ì˜¤ ì¬ìƒì´ ì´ì–´ì§‘ë‹ˆë‹¤.

      \</Text\>

    \</SafeAreaView\>

  );

}

---

### **ğŸƒâ€â™‚ï¸ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ (iOS)**

1. **Xcode ì„¸íŒ… í•„ìˆ˜:** ì•ì„œ ê°•ì¡°í–ˆë“¯, ios í´ë” ì•ˆì˜ .xcworkspaceë¥¼ ì—´ì–´ wakeup-sound.wavë¥¼ ì§ì ‘ ì¶”ê°€í•´ ì£¼ì§€ ì•Šìœ¼ë©´ iOS ê¸°ë³¸ ì•Œë¦¼ìŒ(íŠ¸ë¼ì´í†¤)ì´ ìš¸ë¦½ë‹ˆë‹¤.  
2. **ì‹œë®¬ë ˆì´í„° ì œì•½:** iOS ì‹œë®¬ë ˆì´í„°ì—ì„œëŠ” ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ ë° ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸ê°€ ì œí•œì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ê¸‰ì  **ì‹¤ì œ ì•„ì´í°ì„ Macì— ì—°ê²°í•˜ì—¬ ë¹Œë“œ**(npx expo run:ios)í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.  
3. **í…ŒìŠ¤íŠ¸ ë°©ë²•:** ì•±ì„ ì‹¤í–‰í•˜ê³  ë²„íŠ¼ì„ ëˆ„ë¥¸ ë’¤, **í™ˆ í™”ë©´ìœ¼ë¡œ ë‚˜ê°€ê±°ë‚˜ í™”ë©´ì„ ë•ë‹ˆë‹¤.** 1ë¶„ ë’¤ ë¯¸ë¦¬ ë„£ì–´ë‘” 22ì´ˆì§œë¦¬ ì•ŒëŒ ì†Œë¦¬ê°€ ìš¸ë¦¬ë©° í™”ë©´ì— ì•Œë¦¼ì°½ì´ ëœ¹ë‹ˆë‹¤. **ê·¸ ì•Œë¦¼ì°½ì„ íƒ­í•˜ë©´** ì•±ì´ ì—´ë¦¬ë©´ì„œ ê³§ë°”ë¡œ TrackPlayerê°€ ê°€ë™ë˜ì–´ ì„¤ì •í•´ë‘” íŒŸìºìŠ¤íŠ¸ íŒŒì¼ì´ ì¬ìƒë©ë‹ˆë‹¤.

ì•ˆë“œë¡œì´ë“œì™€ ì•„ì´í° ëª¨ë‘ ê° ìš´ì˜ì²´ì œì˜ ì² í•™ì— ë§ëŠ” ìµœì ì˜ êµ¬í˜„ ì½”ë“œê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤\! í˜¹ì‹œ ë‘ ì½”ë“œë¥¼ í•˜ë‚˜ì˜ ì•±ì— í•©ì¹˜ê¸° ìœ„í•´ í”Œë«í¼ë³„(Platform.OS) ë¶„ê¸° ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë°©ë²•ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”? ì•„ë‹ˆë©´ Firebase Storage ì—°ë™ì˜ ìƒì„¸ ë¡œì§ì„ ë‹¤ë“¬ì–´ ë³¼ê¹Œìš”?

â€”---------------------------

ë‘ ìš´ì˜ì²´ì œì˜ ì™„ì „íˆ ë‹¤ë¥¸ ë°±ê·¸ë¼ìš´ë“œ ì² í•™ì„ í•˜ë‚˜ì˜ ì½”ë“œë² ì´ìŠ¤ë¡œ ìš°ì•„í•˜ê²Œ í†µí•©í•˜ë ¤ë©´ ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì˜ Platform ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ ë¶„ê¸° ì²˜ë¦¬ë¥¼ í•´ì•¼ í•©ë‹ˆë‹¤.

ì•ˆë“œë¡œì´ë“œëŠ” \*\*'ë°±ê·¸ë¼ìš´ë“œ ì´ë²¤íŠ¸(index.js)'\*\*ì—ì„œ ì¬ìƒì„ ì‹œì‘í•˜ê³ , ì•„ì´í°ì€ \*\*'ì‚¬ìš©ì íƒ­ ì´ë²¤íŠ¸(App.js)'\*\*ì—ì„œ ì¬ìƒì„ ì‹œì‘í•œë‹¤ëŠ” í•µì‹¬ ì°¨ì´ì ë§Œ ì˜ ë‚˜ëˆ„ì–´ ì£¼ë©´ ë©ë‹ˆë‹¤.

ë‘ ì½”ë“œë¥¼ í•˜ë‚˜ë¡œ í•©ì¹œ í†µí•© êµ¬ì¡°ë¥¼ ë‹¨ê³„ë³„ë¡œ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.

---

### **ğŸ”€ 1\. ì•ŒëŒ ìŠ¤ì¼€ì¤„ëŸ¬ í†µí•© (src/AlarmManager.js)**

ì•ŒëŒì„ ì˜ˆì•½í•  ë•Œ ë“¤ì–´ê°€ëŠ” ì˜µì…˜(ì±„ë„, ì†Œë¦¬, íŠ¸ë¦¬ê±° ë°©ì‹)ì„ Platform.OSë¡œ ë¶„ê¸°í•˜ì—¬ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ë¬¶ìŠµë‹ˆë‹¤.

JavaScript

import notifee, { TriggerType } from '@notifee/react-native';

import { Platform } from 'react-native';

import \* as FileSystem from 'expo-file-system';

import AsyncStorage from '@react-native-async-storage/async-storage';

export async function createUnifiedAlarm(hour, minute, alarmId, fileUrls) {

  try {

    const localFiles \= \[\];

    const uniqueAlarmId \= \`alarm\_${alarmId}\`;

    // 1\. \[ê³µí†µ\] Firebaseì—ì„œ ê¸°ê¸°ë¡œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë¡œì§ (ì´ì „ê³¼ ë™ì¼)

    for (let i \= 0; i \< fileUrls.length; i++) {

      const downloadUrl \= 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'; // ì„ì‹œ URL

      const fileName \= \`${uniqueAlarmId}\_track\_${i}.mp3\`;

      const localUri \= \`${FileSystem.documentDirectory}${fileName}\`;

      

      const fileInfo \= await FileSystem.getInfoAsync(localUri);

      if (\!fileInfo.exists) await FileSystem.downloadAsync(downloadUrl, localUri);

      localFiles.push({

        id: \`track\_${i}\`,

        url: localUri,

        title: i \=== 0 ? 'ê¸°ìƒ ì•ŒëŒ' : \`íŒŸìºìŠ¤íŠ¸ ${i}\`,

      });

    }

    // 2\. \[ê³µí†µ\] ë‹¤ìš´ë¡œë“œ ì™„ë£Œëœ íŒŒì¼ ëª©ë¡ ì €ì¥

    await AsyncStorage.setItem(\`@alarm\_data\_${uniqueAlarmId}\`, JSON.stringify({ files: localFiles }));

    // 3\. \[ê³µí†µ\] ì‹œê°„ ê³„ì‚°

    const triggerDate \= new Date();

    triggerDate.setHours(hour, minute, 0, 0);

    if (triggerDate.getTime() \< Date.now()) triggerDate.setDate(triggerDate.getDate() \+ 1);

    // 4\. ğŸ”€ \[ë¶„ê¸°\] OSë³„ ì•Œë¦¼ í˜ì´ë¡œë“œ êµ¬ì„±

    let notificationConfig \= {

      id: uniqueAlarmId,

      title: Platform.OS \=== 'ios' ? 'ê¸°ìƒ ì‹œê°„ì…ë‹ˆë‹¤\! â˜€ï¸' : 'ì•ŒëŒ ë™ì‘ ì¤‘',

      body: Platform.OS \=== 'ios' ? 'ì•ŒëŒì„ ë„ê³  ì•„ì¹¨ íŒŸìºìŠ¤íŠ¸ë¥¼ ë“¤ìœ¼ë ¤ë©´ íƒ­í•˜ì„¸ìš”.' : 'íŒŸìºìŠ¤íŠ¸ë¥¼ ì¬ìƒí•©ë‹ˆë‹¤.',

    };

    if (Platform.OS \=== 'android') {

      // ì•ˆë“œë¡œì´ë“œ ì„¤ì •: ë¬´ìŒ ì±„ë„ ìƒì„± (TrackPlayerê°€ ì†Œë¦¬ë¥¼ ë‚´ë¯€ë¡œ)

      const channelId \= await notifee.createChannel({

        id: 'silent\_alarm\_channel',

        name: 'ë¬´ìŒ ì•ŒëŒ ì±„ë„',

        sound: 'default',

        vibration: false,

      });

      notificationConfig.android \= {

        channelId,

        pressAction: { id: 'default' },

      };

    } else if (Platform.OS \=== 'ios') {

      // iOS ì„¤ì •: Xcodeì— ë„£ì€ 22ì´ˆ ì•ŒëŒìŒ ê°•ì œ ì§€ì •

      notificationConfig.ios \= {

        sound: 'wakeup-sound.wav', 

        badgeCount: 1,

      };

    }

    // 5\. ğŸ”€ \[ë¶„ê¸°\] OSë³„ íŠ¸ë¦¬ê±° ì„¤ì • (ì•ˆë“œë¡œì´ë“œë§Œ allowWhileIdle í•„ìš”)

    const trigger \= {

      type: TriggerType.TIMESTAMP,

      timestamp: triggerDate.getTime(),

      ...(Platform.OS \=== 'android' && { alarmManager: { allowWhileIdle: true } }) // ì•ˆë“œë¡œì´ë“œ ì „ìš© ì˜µì…˜ ë³‘í•©

    };

    // 6\. \[ê³µí†µ\] ì•ŒëŒ ì˜ˆì•½ ì™„ë£Œ

    await notifee.createTriggerNotification(notificationConfig, trigger);

    console.log(\`${Platform.OS} ì•ŒëŒ ì˜ˆì•½ ì™„ë£Œ\!\`);

    return true;

  } catch (error) {

    console.error('ì•ŒëŒ ì„¤ì • ì‹¤íŒ¨:', error);

    return false;

  }

}

---

### **ğŸ”€ 2\. ë°±ê·¸ë¼ìš´ë“œ ì§„ì…ì  í†µí•© (index.js)**

ì´ íŒŒì¼ì€ ì•±ì´ êº¼ì ¸ ìˆì„ ë•Œ ì‘ë™í•©ë‹ˆë‹¤. iOSëŠ” ì´ ë‹¨ê³„ì—ì„œ í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ì—†ìœ¼ë¯€ë¡œ, ì•ˆë“œë¡œì´ë“œì¼ ë•Œë§Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì‘ë™í•˜ë„ë¡ ê°ì‹¸ì¤ë‹ˆë‹¤.

JavaScript

import { AppRegistry, Platform } from 'react-native';

import notifee, { EventType } from '@notifee/react-native';

import TrackPlayer from 'react-native-track-player';

import App from './App';

import { name as appName } from './app.json';

import { setupPlayer, playPodcast } from './src/TrackPlayerService';

import AsyncStorage from '@react-native-async-storage/async-storage';

// ğŸ”€ \[ë¶„ê¸°\] ì•ˆë“œë¡œì´ë“œë§Œ ë°±ê·¸ë¼ìš´ë“œ ì´ë²¤íŠ¸ì—ì„œ ì¦‰ì‹œ ì¬ìƒ ì‹œì‘

if (Platform.OS \=== 'android') {

  notifee.onBackgroundEvent(async ({ type, detail }) \=\> {

    if (type \=== EventType.DELIVERED && detail.notification?.id?.startsWith('alarm\_')) {

      const alarmDataStr \= await AsyncStorage.getItem(\`@alarm\_data\_${detail.notification.id}\`);

      if (alarmDataStr) {

        const { files } \= JSON.parse(alarmDataStr);

        await setupPlayer();

        await playPodcast(files); // ì‚¬ìš©ì ê°œì… ì—†ì´ ë°”ë¡œ íŒŸìºìŠ¤íŠ¸ íì— ë„£ê³  ì¬ìƒ

      }

    }

  });

}

// \[ê³µí†µ\] ë°±ê·¸ë¼ìš´ë“œ ë¯¸ë””ì–´ ì»¨íŠ¸ë¡¤ ì„œë¹„ìŠ¤ ë“±ë¡

TrackPlayer.registerPlaybackService(() \=\> require('./src/TrackPlayerPlaybackService'));

AppRegistry.registerComponent(appName, () \=\> App);

---

### **ğŸ”€ 3\. ì•± í™”ë©´ ë° íƒ­ ì´ë²¤íŠ¸ í†µí•© (App.js)**

ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ íƒ­í•˜ê³  ë“¤ì–´ì™”ì„ ë•Œ, ì•ˆë“œë¡œì´ë“œëŠ” ì´ë¯¸ index.jsì—ì„œ ì†Œë¦¬ê°€ ë‚˜ê³  ìˆëŠ” ìƒíƒœì´ë¯€ë¡œ ì•„ë¬´ê²ƒë„ í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ë°˜ë©´ iOSëŠ” ì´ ìˆœê°„ì´ ë¹„ë¡œì†Œ ì¬ìƒì„ ì‹œì‘í•´ì•¼ í•˜ëŠ” íƒ€ì´ë°ì…ë‹ˆë‹¤.

JavaScript

import React, { useEffect } from 'react';

import { View, Text, Button, Alert, Platform } from 'react-native';

import notifee, { EventType } from '@notifee/react-native';

import AsyncStorage from '@react-native-async-storage/async-storage';

import { createUnifiedAlarm } from './src/AlarmManager';

import { setupPlayer, playPodcast } from './src/TrackPlayerService';

export default function App() {

  useEffect(() \=\> {

    async function init() {

      await notifee.requestPermission();

      await setupPlayer();

    }

    init();

    // ğŸ”€ \[ë¶„ê¸°\] iOS ì „ìš©: ì•Œë¦¼ì„ íƒ­í–ˆì„ ë•Œ íŒŸìºìŠ¤íŠ¸ ì¬ìƒ ì‹œì‘

    const handleNotificationTap \= async (notification) \=\> {

      if (Platform.OS \=== 'ios' && notification?.id?.startsWith('alarm\_')) {

        console.log('\[iOS\] ì•Œë¦¼ íƒ­ ê°ì§€. ì¬ìƒ ì‹œì‘\!');

        

        const alarmDataStr \= await AsyncStorage.getItem(\`@alarm\_data\_${notification.id}\`);

        if (alarmDataStr) {

          const { files } \= JSON.parse(alarmDataStr);

          await setupPlayer();

          await playPodcast(files);

          notifee.setBadgeCount(0);

        }

      }

      // ì•ˆë“œë¡œì´ë“œëŠ” ì´ë¯¸ index.jsê°€ ì¬ìƒ ì¤‘ì´ë¯€ë¡œ ì•± í™”ë©´ë§Œ ì—´ë¦¬ê²Œ ëƒ…ë‘¡ë‹ˆë‹¤.

    };

    // \[ê³µí†µ\] ì•±ì´ êº¼ì ¸ ìˆë‹¤ê°€ ì•Œë¦¼ íƒ­ìœ¼ë¡œ ì¼œì§„ ê²½ìš°

    notifee.getInitialNotification().then(initialNotification \=\> {

      if (initialNotification) handleNotificationTap(initialNotification.notification);

    });

    // \[ê³µí†µ\] ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆë‹¤ê°€ ì•Œë¦¼ íƒ­ìœ¼ë¡œ ì¼œì§„ ê²½ìš°

    const unsubscribe \= notifee.onForegroundEvent(({ type, detail }) \=\> {

      if (type \=== EventType.PRESS) handleNotificationTap(detail.notification);

    });

    return () \=\> unsubscribe();

  }, \[\]);

  const handleTestAlarm \= async () \=\> {

    const now \= new Date();

    now.setMinutes(now.getMinutes() \+ 1);

    await createUnifiedAlarm(now.getHours(), now.getMinutes(), 'test', \['gs://url1', 'gs://url2'\]);

    Alert.alert('í†µí•© ì•ŒëŒ ì„¤ì • ì™„ë£Œ', '1ë¶„ ë’¤ ê° OS ì •ì±…ì— ë§ê²Œ ì•ŒëŒì´ ìš¸ë¦½ë‹ˆë‹¤.');

  };

  return (

    \<View style\={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}\>

      \<Text\>í†µí•© íŒŸìºìŠ¤íŠ¸ ì•ŒëŒ ì•±\</Text\>

      \<Button title\="1ë¶„ ë’¤ ì•ŒëŒ í…ŒìŠ¤íŠ¸" onPress\={handleTestAlarm} /\>

    \</View\>

  );

}

â€”----------------------

Firebaseì˜ gs:// ì£¼ì†Œë¥¼ ì‹¤ì œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ https:// ì£¼ì†Œë¡œ ë³€í™˜í•˜ëŠ” **Firebase Storage SDK ì—°ë™ ì„¸ë¶€ ë¡œì§**ì„ ì‘ì„±í•´ ë³¼ê¹Œìš”?

â€”----------------------------

Firebase Storageì— ì €ì¥ëœ gs:// í˜•íƒœì˜ ì£¼ì†Œë¥¼ ì•±ì—ì„œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆëŠ” ì‹¤ì œ https:// ì£¼ì†Œë¡œ ë³€í™˜í•˜ê³ , ì´ë¥¼ ê¸°ê¸°ì— ì €ì¥í•˜ëŠ” ì„¸ë¶€ ë¡œì§ì„ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ì „ì— ì‘ì„±í–ˆë˜ ê°€ì§œ URL(https://www.soundhelix.com/...)ì„ ê±·ì–´ë‚´ê³ , ì‹¤ì œ Firebase SDKë¥¼ ì—°ë™í•˜ì—¬ ê³ ìš©ëŸ‰ WAVë‚˜ MOV íŒŒì¼ë“¤ì„ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ë„ë¡ êµ¬ì„±í•˜ê² ìŠµë‹ˆë‹¤.

---

### **ğŸ“¦ 1\. Firebase SDK ì„¤ì¹˜ ë° ì´ˆê¸°í™”**

ë¨¼ì € í”„ë¡œì íŠ¸ì— Firebase íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

Bash

npx expo install firebase

ê·¸ë¦¬ê³  í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— firebaseConfig.js íŒŒì¼ì„ ìƒì„±í•˜ì—¬ Firebaseë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. (Firebase ì½˜ì†”ì—ì„œ ì œê³µí•˜ëŠ” í”„ë¡œì íŠ¸ ì„¤ì • ê°’ì„ ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.)

JavaScript

// firebaseConfig.js

import { initializeApp } from 'firebase/app';

import { getStorage } from 'firebase/storage';

const firebaseConfig \= {

  apiKey: "AIzaSyDOC\_EXAMPLE\_KEY",

  authDomain: "my-alarm-5fb86.firebaseapp.com",

  projectId: "my-alarm-5fb86",

  storageBucket: "my-alarm-5fb86.firebasestorage.app", // gs:// ì£¼ì†Œì˜ í•µì‹¬ ë„ë©”ì¸

  messagingSenderId: "123456789",

  appId: "1:123456789:web:abcdef"

};

// Firebase ì•± ì´ˆê¸°í™”

const app \= initializeApp(firebaseConfig);

// Storage ì¸ìŠ¤í„´ìŠ¤ ë‚´ë³´ë‚´ê¸° (ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•¨)

export const storage \= getStorage(app);

---

### **ğŸ”„ 2\. URL ë³€í™˜ ìœ í‹¸ë¦¬í‹° ìƒì„± (src/FirebaseService.js)**

gs:// URLì„ ì…ë ¥ë°›ì•„ expo-file-systemì´ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆëŠ” https:// í˜•íƒœì˜ ë‹¤ìš´ë¡œë“œ í† í° URLë¡œ ë³€í™˜í•´ ì£¼ëŠ” ì „ìš© í•¨ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤.

JavaScript

// src/FirebaseService.js

import { ref, getDownloadURL } from 'firebase/storage';

import { storage } from '../firebaseConfig';

/\*\*

 \* Firebase gs:// URLì„ ì‹¤ì œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ https:// URLë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

 \* @param {string} gsUrl \- ì˜ˆ: 'gs://my-alarm-5fb86.firebasestorage.app/wakeup-sound.wav'

 \* @returns {Promise\<string\>} \- ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ URL ë°˜í™˜

 \*/

export async function getDownloadUrlFromGs(gsUrl) {

  try {

    // 1\. Storage Reference(ì°¸ì¡°) ìƒì„±

    // gs:// ì£¼ì†Œë¥¼ ê·¸ëŒ€ë¡œ ref()ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ë„˜ê²¨ì£¼ë©´ Firebaseê°€ ìë™ìœ¼ë¡œ ê²½ë¡œë¥¼ ì¸ì‹í•©ë‹ˆë‹¤.

    const fileRef \= ref(storage, gsUrl);

    // 2\. ë‹¤ìš´ë¡œë“œ URL ìš”ì²­ (ë¹„ë™ê¸° ì²˜ë¦¬)

    const downloadUrl \= await getDownloadURL(fileRef);

    

    return downloadUrl;

  } catch (error) {

    console.error(\`\[Firebase\] URL ë³€í™˜ ì‹¤íŒ¨ (${gsUrl}):\`, error);

    throw error; // ì‹¤íŒ¨ ì‹œ ì•ŒëŒ ì„¤ì • ìì²´ë¥¼ ì¤‘ë‹¨ì‹œí‚¤ê¸° ìœ„í•´ ì—ëŸ¬ë¥¼ ë˜ì§‘ë‹ˆë‹¤.

  }

}

---

### **ğŸ”— 3\. ê¸°ì¡´ ì•ŒëŒ ë§¤ë‹ˆì €(src/AlarmManager.js)ì— ì—°ë™í•˜ê¸°**

ì´ì œ ì´ì „ ë‹¨ê³„ì—ì„œ ë§Œë“¤ì—ˆë˜ createUnifiedAlarm í•¨ìˆ˜ ë‚´ì˜ ì„ì‹œ URL ë¶€ë¶„ì„ ì§€ìš°ê³ , ë°©ê¸ˆ ë§Œë“  Firebase ì—°ë™ ë¡œì§ìœ¼ë¡œ êµì²´í•©ë‹ˆë‹¤.

JavaScript

// src/AlarmManager.js

import notifee, { TriggerType } from '@notifee/react-native';

import { Platform } from 'react-native';

import \* as FileSystem from 'expo-file-system';

import AsyncStorage from '@react-native-async-storage/async-storage';

import { getDownloadUrlFromGs } from './FirebaseService'; // ğŸ‘ˆ ìƒˆë¡œ ì¶”ê°€í•œ ì„œë¹„ìŠ¤ ì„í¬íŠ¸

export async function createUnifiedAlarm(hour, minute, alarmId, fileUrls) {

  try {

    const localFiles \= \[\];

    const uniqueAlarmId \= \`alarm\_${alarmId}\`;

    // 1\. Firebaseì—ì„œ ê¸°ê¸°ë¡œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ

    for (let i \= 0; i \< fileUrls.length; i++) {

      const gsUrl \= fileUrls\[i\];

      const fileName \= \`${uniqueAlarmId}\_track\_${i}.wav\`; // íŒŒì¼ í™•ì¥ìì— ë§ê²Œ ë™ì  ì„¤ì • ê°€ëŠ¥

      const localUri \= \`${FileSystem.documentDirectory}${fileName}\`;

      

      const fileInfo \= await FileSystem.getInfoAsync(localUri);

      

      // ê¸°ê¸°ì— íŒŒì¼ì´ ì—†ì„ ë•Œë§Œ Firebaseì—ì„œ ë‹¤ìš´ë¡œë“œ ì§„í–‰

      if (\!fileInfo.exists) {

        console.log(\`\[ë‹¤ìš´ë¡œë“œ ì‹œì‘\] Firebase URL ë³€í™˜ ì¤‘... (${gsUrl})\`);

        

        // ğŸš¨ í•µì‹¬ ì—°ë™ ë¶€ìœ„: gs:// \-\> https:// ë³€í™˜

        const downloadUrl \= await getDownloadUrlFromGs(gsUrl);

        

        console.log(\`\[ë‹¤ìš´ë¡œë“œ ì¤‘\] ë¡œì»¬ì— ì €ì¥í•©ë‹ˆë‹¤...\`);

        // ë³€í™˜ëœ URLì„ ì‚¬ìš©í•´ ê¸°ê¸° ë‚´ë¶€ë¡œ ë‹¤ìš´ë¡œë“œ

        await FileSystem.downloadAsync(downloadUrl, localUri);

        console.log(\`\[ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\] ì €ì¥ ìœ„ì¹˜: ${localUri}\`);

      } else {

        console.log(\`\[ë‹¤ìš´ë¡œë“œ íŒ¨ìŠ¤\] ì´ë¯¸ ë¡œì»¬ì— íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤: ${localUri}\`);

      }

      // ì¬ìƒ ëª©ë¡ ë°°ì—´ì— ì¶”ê°€

      localFiles.push({

        id: \`track\_${i}\`,

        url: localUri, // TrackPlayerëŠ” ì´ file:// ê²½ë¡œë¥¼ ì½ì–´ ì¬ìƒí•©ë‹ˆë‹¤.

        title: i \=== 0 ? 'ê¸°ìƒ ì•ŒëŒ' : \`íŒŸìºìŠ¤íŠ¸ ${i}\`,

      });

    }

    // ... (ì´í•˜ 2\. AsyncStorage ì €ì¥ ë° 3\. Notifee ì•ŒëŒ ì˜ˆì•½ ë¡œì§ì€ ì´ì „ê³¼ 100% ë™ì¼)

    

    // 2\. ë‹¤ìš´ë¡œë“œ ì™„ë£Œëœ íŒŒì¼ ëª©ë¡ ì €ì¥

    await AsyncStorage.setItem(\`@alarm\_data\_${uniqueAlarmId}\`, JSON.stringify({ files: localFiles }));

    // 3\. ì‹œê°„ ê³„ì‚°

    const triggerDate \= new Date();

    triggerDate.setHours(hour, minute, 0, 0);

    if (triggerDate.getTime() \< Date.now()) triggerDate.setDate(triggerDate.getDate() \+ 1);

    // 4\. OSë³„ ì•Œë¦¼ í˜ì´ë¡œë“œ êµ¬ì„±

    let notificationConfig \= {

      id: uniqueAlarmId,

      title: Platform.OS \=== 'ios' ? 'ê¸°ìƒ ì‹œê°„ì…ë‹ˆë‹¤\! â˜€ï¸' : 'ì•ŒëŒ ë™ì‘ ì¤‘',

      body: Platform.OS \=== 'ios' ? 'ì•ŒëŒì„ ë„ê³  ì•„ì¹¨ íŒŸìºìŠ¤íŠ¸ë¥¼ ë“¤ìœ¼ë ¤ë©´ íƒ­í•˜ì„¸ìš”.' : 'íŒŸìºìŠ¤íŠ¸ë¥¼ ì¬ìƒí•©ë‹ˆë‹¤.',

    };

    if (Platform.OS \=== 'android') {

      const channelId \= await notifee.createChannel({

        id: 'silent\_alarm\_channel',

        name: 'ë¬´ìŒ ì•ŒëŒ ì±„ë„',

        sound: 'default',

        vibration: false,

      });

      notificationConfig.android \= { channelId, pressAction: { id: 'default' } };

    } else if (Platform.OS \=== 'ios') {

      notificationConfig.ios \= { sound: 'wakeup-sound.wav', badgeCount: 1 };

    }

    // 5\. íŠ¸ë¦¬ê±° ì„¤ì • ë° ì˜ˆì•½

    const trigger \= {

      type: TriggerType.TIMESTAMP,

      timestamp: triggerDate.getTime(),

      ...(Platform.OS \=== 'android' && { alarmManager: { allowWhileIdle: true } })

    };

    await notifee.createTriggerNotification(notificationConfig, trigger);

    console.log(\`${Platform.OS} ì•ŒëŒ ë° Firebase ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\!\`);

    return true;

  } catch (error) {

    console.error('ì•ŒëŒ ì„¤ì • ë° ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);

    return false;

  }

}

---

### **ğŸ›¡ï¸ ì£¼ì˜: Firebase Storage ë³´ì•ˆ ê·œì¹™ í™•ì¸**

ì½”ë“œê°€ ì™„ë²½í•˜ë”ë¼ë„ Firebase ì½˜ì†”ì˜ Storage ê·œì¹™(Rules)ì´ ë§‰í˜€ìˆìœ¼ë©´ getDownloadURL í˜¸ì¶œ ì‹œ 403 Forbidden ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ì´ˆê¸° í…ŒìŠ¤íŠ¸ ì¤‘ì´ë¼ë©´ Firebase ì½˜ì†” \-\> Storage \-\> Rules íƒ­ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì™¸ë¶€ ì½ê¸° ê¶Œí•œì„ ì ì‹œ í—ˆìš©í•´ ë‘ì‹œëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

Plaintext

// Firebase Storage Rules ì˜ˆì‹œ (í…ŒìŠ¤íŠ¸ìš©)

rules\_version \= '2';

service firebase.storage {

  match /b/{bucket}/o {

    match /{allPaths=\*\*} {

      allow read: if true; // ëˆ„êµ¬ë‚˜ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥

      allow write: if request.auth \!= null; // ì—…ë¡œë“œëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ

    }

  }

}

ì´ì œ ë°±ì—”ë“œ ì—°ë™ë¶€í„° ë„¤ì´í‹°ë¸Œ ë‹¨ì˜ ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤ ì¬ìƒê¹Œì§€ ëª¨ë“  í•µì‹¬ ì¸í”„ë¼ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.

â€”--------------------------------

**ì‚¬ìš©ì ê¸°ê¸° ë‚´ë¶€ì— ìˆëŠ” ê°œì¸ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì„ íƒ(Document Picker)í•˜ì—¬ ì•ŒëŒìœ¼ë¡œ ì§€ì •í•˜ëŠ” ë¡œì§**

â€”---------------------------

ì‚¬ìš©ìì˜ ìŠ¤ë§ˆíŠ¸í°ì— ì €ì¥ëœ ê°œì¸ ì˜¤ë””ì˜¤ íŒŒì¼(WAV, MP3 ë“±)ì„ ì§ì ‘ ì„ íƒí•˜ì—¬ ì•ŒëŒìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê¸°ëŠ¥ì€ **expo-document-picker** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ë§¤ìš° ì§ê´€ì ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ ê°€ì¥ ì¤‘ìš”í•œ í•µì‹¬ì€ \*\*"ì„ íƒí•œ íŒŒì¼ì˜ ê¶Œí•œ ìœ ì§€"\*\*ì…ë‹ˆë‹¤. OS(íŠ¹íˆ iOS)ëŠ” ì‚¬ìš©ìê°€ ì„ íƒí•œ íŒŒì¼ì˜ ì›ë³¸ ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì•±ì´ ì¢…ë£Œë˜ë©´ íšŒìˆ˜í•´ ë²„ë¦½ë‹ˆë‹¤. ë”°ë¼ì„œ **ì„ íƒí•œ íŒŒì¼ì„ ì•± ë‚´ë¶€ì˜ ì•ˆì „í•œ í´ë”(documentDirectory)ë¡œ ë³µì‚¬í•´ ë‘ëŠ” ì‘ì—…**ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.

---

### **ğŸ“‚ 1\. íŒŒì¼ ì„ íƒê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜**

Expoì—ì„œ ì œê³µí•˜ëŠ” ê³µì‹ ë¬¸ì„œ ì„ íƒê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

Bash

npx expo install expo-document-picker expo-file-system

---

### **ğŸ› ï¸ 2\. ë¡œì»¬ íŒŒì¼ ì„ íƒ ë° ë³µì‚¬ ë¡œì§ (src/LocalFileService.js)**

íŒŒì¼ íƒìƒ‰ê¸°ë¥¼ ë„ìš°ê³ , ì„ íƒëœ íŒŒì¼ì„ ì•±ì˜ ë¡œì»¬ ì €ì¥ì†Œë¡œ ì•ˆì „í•˜ê²Œ ë³µì‚¬í•˜ì—¬ ì˜êµ¬ì ì¸ file:// ê²½ë¡œë¥¼ ë°˜í™˜í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤.

JavaScript

import \* as DocumentPicker from 'expo-document-picker';

import \* as FileSystem from 'expo-file-system';

/\*\*

 \* ê¸°ê¸° ë‚´ë¶€ì˜ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•˜ê³  ì•± ë‚´ë¶€ í´ë”ë¡œ ì•ˆì „í•˜ê²Œ ë³µì‚¬í•©ë‹ˆë‹¤.

 \* @returns {Promise\<{uri: string, name: string} | null\>} ë³µì‚¬ëœ íŒŒì¼ì˜ ì˜êµ¬ ë¡œì»¬ ê²½ë¡œì™€ ì´ë¦„

 \*/

export async function pickAndSaveLocalAudio() {

  try {

    // 1\. ë„¤ì´í‹°ë¸Œ íŒŒì¼ íƒìƒ‰ê¸° ì—´ê¸° (ì˜¤ë””ì˜¤ íŒŒì¼ë§Œ ì„ íƒí•˜ë„ë¡ í•„í„°ë§)

    const result \= await DocumentPicker.getDocumentAsync({

      type: 'audio/\*', // 'audio/wav', 'audio/mpeg' ë“±ìœ¼ë¡œ ì„¸ë¶„í™” ê°€ëŠ¥

      copyToCacheDirectory: false, // ì§ì ‘ ë³µì‚¬í•  ê²ƒì´ë¯€ë¡œ ìºì‹œ ë³µì‚¬ëŠ” ë•ë‹ˆë‹¤

    });

    // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°

    if (result.canceled) {

      console.log('íŒŒì¼ ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');

      return null;

    }

    // 2\. ì„ íƒëœ íŒŒì¼ ì •ë³´ ì¶”ì¶œ

    const pickedFile \= result.assets\[0\];

    const originalUri \= pickedFile.uri;

    const fileName \= pickedFile.name || \`local\_audio\_${Date.now()}.wav\`;

    // 3\. ì•±ì˜ ì˜êµ¬ì ì¸ ë„íë¨¼íŠ¸ ë””ë ‰í† ë¦¬ ê²½ë¡œ ìƒì„±

    const permanentUri \= \`${FileSystem.documentDirectory}${fileName}\`;

    // 4\. \[í•µì‹¬\] ì„ì‹œ ê²½ë¡œ(ë˜ëŠ” ì™¸ë¶€ ê²½ë¡œ)ì—ì„œ ì•± ë‚´ë¶€ í´ë”ë¡œ íŒŒì¼ ë³µì‚¬

    // ì´ë ‡ê²Œ í•´ì•¼ ì•±ì„ ê»ë‹¤ ì¼œë„, ì•ŒëŒì´ ìš¸ë¦´ ë•Œë„ ë¬´ì¡°ê±´ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    await FileSystem.copyAsync({

      from: originalUri,

      to: permanentUri,

    });

    console.log(\`ë¡œì»¬ ì˜¤ë””ì˜¤ ë³µì‚¬ ì™„ë£Œ: ${permanentUri}\`);

    // ë³µì‚¬ëœ ì˜êµ¬ ê²½ë¡œì™€ íŒŒì¼ëª…ì„ ë°˜í™˜

    return {

      uri: permanentUri, 

      name: fileName

    };

  } catch (error) {

    console.error('ë¡œì»¬ íŒŒì¼ ì„ íƒ ë° ë³µì‚¬ ì‹¤íŒ¨:', error);

    return null;

  }

}

---

### **ğŸ”— 3\. ê¸°ì¡´ ì•ŒëŒ ë§¤ë‹ˆì €(AlarmManager.js) ì—…ë°ì´íŠ¸**

ì´ì „ì— ë§Œë“  createUnifiedAlarm í•¨ìˆ˜ëŠ” gs:// í˜•íƒœì˜ Firebase URLë§Œ ì²˜ë¦¬í•˜ë„ë¡ ì‘ì„±ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ì œ **Firebase URL(gs://)ê³¼ ë¡œì»¬ íŒŒì¼ ê²½ë¡œ(file://)ë¥¼ ëª¨ë‘ ì„ì–´ì„œ ì²˜ë¦¬**í•  ìˆ˜ ìˆë„ë¡ ì•„ì£¼ ì‚´ì§ë§Œ ìˆ˜ì •í•´ ì£¼ë©´ ë©ë‹ˆë‹¤.

JavaScript

// src/AlarmManager.js ì˜ createUnifiedAlarm ë‚´ë¶€ ë¡œì§ ìˆ˜ì • (forë¬¸ ë¶€ë¶„)

    // 1\. ì˜¤ë””ì˜¤ íŒŒì¼ ê²½ë¡œ ì²˜ë¦¬ (Firebase ë‹¤ìš´ë¡œë“œ or ë¡œì»¬ íŒŒì¼ ìœ ì§€)

    for (let i \= 0; i \< fileUrls.length; i++) {

      const currentUrl \= fileUrls\[i\];

      let finalLocalUri \= '';

      // A. ë§Œì•½ Firebase URL(gs://)ì´ë¼ë©´ ê¸°ì¡´ì²˜ëŸ¼ ë‹¤ìš´ë¡œë“œ ì§„í–‰

      if (currentUrl.startsWith('gs://')) {

        const fileName \= \`${uniqueAlarmId}\_track\_${i}.wav\`;

        finalLocalUri \= \`${FileSystem.documentDirectory}${fileName}\`;

        const fileInfo \= await FileSystem.getInfoAsync(finalLocalUri);

        

        if (\!fileInfo.exists) {

          const downloadUrl \= await getDownloadUrlFromGs(currentUrl);

          await FileSystem.downloadAsync(downloadUrl, finalLocalUri);

        }

      } 

      // B. ë§Œì•½ ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒí•œ ë¡œì»¬ íŒŒì¼(file://)ì´ë¼ë©´ ë‹¤ìš´ë¡œë“œ ì—†ì´ ê²½ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©\!

      else if (currentUrl.startsWith('file://')) {

        finalLocalUri \= currentUrl; 

      }

      // ì¬ìƒ ëª©ë¡ ë°°ì—´ì— ì¶”ê°€

      localFiles.push({

        id: \`track\_${i}\`,

        url: finalLocalUri, 

        title: i \=== 0 ? 'ê¸°ìƒ ì•ŒëŒ' : \`íŒŸìºìŠ¤íŠ¸ íŠ¸ë™ ${i}\`,

      });

    }

---

### **ğŸ“± 4\. ë©”ì¸ í™”ë©´(App.js)ì— UI ì—°ê²°í•˜ê¸°**

ì´ì œ ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì‹ ì˜ ê¸°ê¸°ì— ìˆëŠ” íŒŒì¼ì„ ê³ ë¥´ê³ , ê·¸ íŒŒì¼ì„ ì•ŒëŒ ì¬ìƒ ëª©ë¡ì— í¬í•¨ì‹œí‚¤ëŠ” í…ŒìŠ¤íŠ¸ í™”ë©´ì„ êµ¬ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.

JavaScript

import React, { useState } from 'react';

import { View, Text, Button, Alert, ScrollView } from 'react-native';

import { pickAndSaveLocalAudio } from './src/LocalFileService';

import { createUnifiedAlarm } from './src/AlarmManager';

export default function App() {

  // ì•ŒëŒì— ì‚¬ìš©í•  ì¬ìƒ ëª©ë¡ (URL ë°°ì—´)

  const \[playlistUrls, setPlaylistUrls\] \= useState(\[

    'gs://my-alarm-5fb86.firebasestorage.app/wakeup-sound.wav' // 1ë²ˆ íŠ¸ë™: ê¸°ë³¸ ì•ŒëŒ (Firebase)

  \]);

  // ì‚¬ìš©ìê°€ ê¸°ê¸°ì—ì„œ íŒŒì¼ì„ ì„ íƒí•˜ëŠ” í•¨ìˆ˜

  const handlePickLocalFile \= async () \=\> {

    const savedLocalFile \= await pickAndSaveLocalAudio();

    

    if (savedLocalFile) {

      // ì„ íƒí•œ ë¡œì»¬ íŒŒì¼ì˜ URI(file://...)ë¥¼ ì¬ìƒ ëª©ë¡ ë°°ì—´ì— ì¶”ê°€í•©ë‹ˆë‹¤.

      setPlaylistUrls(prevUrls \=\> \[...prevUrls, savedLocalFile.uri\]);

      Alert.alert('íŒŒì¼ ì¶”ê°€ë¨', \`${savedLocalFile.name}ì´(ê°€) ì¬ìƒ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\`);

    }

  };

  // ì•ŒëŒ ì„¤ì • í•¨ìˆ˜

  const handleSetAlarm \= async () \=\> {

    const now \= new Date();

    now.setMinutes(now.getMinutes() \+ 1); // 1ë¶„ ë’¤ ì•ŒëŒ

    // Firebase URLê³¼ ë¡œì»¬ íŒŒì¼ ê²½ë¡œê°€ ì„ì¸ ë°°ì—´ì„ ê·¸ëŒ€ë¡œ ë„˜ê¹ë‹ˆë‹¤.

    const success \= await createUnifiedAlarm(now.getHours(), now.getMinutes(), 'custom\_alarm', playlistUrls);

    

    if (success) {

      Alert.alert('ì•ŒëŒ ì„¤ì • ì™„ë£Œ', '1ë¶„ ë’¤ ì•ŒëŒì´ ìš¸ë¦¬ë©´ ì„ íƒí•œ íŒŒì¼ë“¤ì´ ìˆœì„œëŒ€ë¡œ ì¬ìƒë©ë‹ˆë‹¤.');

    }

  };

  return (

    \<View style\={{ flex: 1, padding: 20, justifyContent: 'center' }}\>

      \<Text style\={{ fontSize: 20, fontWeight: 'bold', marginBottom: 20, textAlign: 'center' }}\>

        ë‚˜ë§Œì˜ íŒŸìºìŠ¤íŠ¸ ì•ŒëŒ

      \</Text\>

      \<Button title\="ğŸµ ë‚´ ê¸°ê¸°ì—ì„œ ì˜¤ë””ì˜¤ íŒŒì¼ ì¶”ê°€" onPress\={handlePickLocalFile} /\>

      \<ScrollView style\={{ marginVertical: 20, maxHeight: 150, backgroundColor: '\#f0f0f0', padding: 10 }}\>

        \<Text style\={{ fontWeight: 'bold', marginBottom: 5 }}\>í˜„ì¬ ì¬ìƒ ëª©ë¡ ({playlistUrls.length}ê°œ):\</Text\>

        {playlistUrls.map((url, index) \=\> (

          \<Text key\={index} numberOfLines\={1} style\={{ fontSize: 12, marginVertical: 2 }}\>

            {index \+ 1}. {url.startsWith('gs://') ? 'â˜ï¸ Firebase ê¸°ë³¸ ì•ŒëŒ' : 'ğŸ“± ë‚´ ê¸°ê¸° ë¡œì»¬ íŒŒì¼'}

          \</Text\>

        ))}

      \</ScrollView\>

      \<Button title\="â° 1ë¶„ ë’¤ ì•ŒëŒ ì„¤ì •í•˜ê¸°" onPress\={handleSetAlarm} color\="green" /\>

    \</View\>

  );

}

ì´ì œ ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì‚¬ìš©ìëŠ” **'ë‚´ ê¸°ê¸°ì—ì„œ ì˜¤ë””ì˜¤ íŒŒì¼ ì¶”ê°€'** ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì‹ ì˜ í•¸ë“œí°ì— ìˆëŠ” ë…¸ë˜ë‚˜ íŒŸìºìŠ¤íŠ¸ íŒŒì¼ì„ ì„ íƒí•  ìˆ˜ ìˆê³ , ì‹œê°„ì´ ë˜ë©´ **Firebaseì—ì„œ ë‹¤ìš´ë°›ì€ ê¸°ë³¸ ì•ŒëŒìŒì´ ìš¸ë¦° ë’¤, ì‚¬ìš©ìê°€ ì§ì ‘ ì¶”ê°€í•œ ê°œì¸ íŒŒì¼ì´ ì´ì–´ì„œ ì¬ìƒ**ë˜ëŠ” ì™„ë²½í•œ ì»¤ìŠ¤í…€ íŒŸìºìŠ¤íŠ¸ ì•ŒëŒì´ ì‘ë™í•˜ê²Œ ë©ë‹ˆë‹¤\!

ì´ì œ ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ, Firebase ë‹¤ìš´ë¡œë“œ, ê°œì¸ íŒŒì¼ ì„ íƒê¹Œì§€ ëª¨ë“  ë°ì´í„° ë¡œì§ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

â€”-------------------------------------------

ë‹¤ìŒìœ¼ë¡œëŠ” ì§ê´€ì ìœ¼ë¡œ **ì˜¤ì „/ì˜¤í›„ì™€ ì‹œê°„ì„ ìœ„ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ì„ íƒí•˜ëŠ” íƒ€ì´ë¨¸(TimePicker) UIì™€ ìš”ì¼ ì„ íƒ ë²„íŠ¼(ì›”\~ì¼)ì„ ë§Œë“œëŠ” ì‘ì—…**

â€”-----------------------------

"ìœ„ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ì‹œê°„ì„ ë§ì¶”ëŠ” íœ (Wheel) UI"ì™€ "ìš”ì¼ ì„ íƒ ë²„íŠ¼"ì„ êµ¬ì„±í•˜ëŠ” ì‘ì—…ì€ ì•ŒëŒ ì•±ì˜ ì²«ì¸ìƒì„ ê²°ì •í•˜ëŠ” ë§¤ìš° ì¤‘ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.

ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œ ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ë¡œëŠ” ì–‘ëŒ€ OS(ì•ˆë“œë¡œì´ë“œ, iOS)ì—ì„œ ë™ì¼í•˜ê²Œ ì˜ˆìœ ìŠ¤í¬ë¡¤ íœ  ëª¨ì–‘ì„ êµ¬í˜„í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì—, ì´ ë¶„ì•¼ì—ì„œ ê°€ì¥ ë§ì´ ì“°ì´ê³  ê²€ì¦ëœ **react-native-date-picker** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê°•ë ¥íˆ ì¶”ì²œí•©ë‹ˆë‹¤.

ìš”ì¼ ì„ íƒ ë²„íŠ¼ì€ ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì˜ ê¸°ë³¸ ìƒíƒœ(State) ê´€ë¦¬ì™€ í„°ì¹˜ ì»´í¬ë„ŒíŠ¸(TouchableOpacity)ë§Œìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### **ğŸ“¦ 1\. íœ  íƒ€ì„í”¼ì»¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜**

í„°ë¯¸ë„ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. (ë„¤ì´í‹°ë¸Œ ì½”ë“œê°€ í¬í•¨ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë¯€ë¡œ ì„¤ì¹˜ í›„ npx expo prebuild \--clean ë° ì¬ë¹Œë“œê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

Bash

npm install react-native-date-picker

---

### **ğŸ¨ 2\. ì•ŒëŒ ì„¤ì • í™”ë©´ UI ì½”ë“œ (src/AlarmSettingScreen.js)**

ì‹œê°„ ì„ íƒ íœ ê³¼ ì›”\~ì¼ ìš”ì¼ ì„ íƒ ë²„íŠ¼, ê·¸ë¦¬ê³  ì„¤ì •ëœ ê°’ì„ ì¶”ì¶œí•˜ëŠ” ë¡œì§ì´ ëª¨ë‘ í¬í•¨ëœ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

JavaScript

import React, { useState } from 'react';

import { View, Text, TouchableOpacity, StyleSheet, Alert } from 'react-native';

import DatePicker from 'react-native-date-picker';

// ìš”ì¼ ë°ì´í„° (0: ì¼ìš”ì¼ \~ 6: í† ìš”ì¼ \- JavaScript Date ê°ì²´ ê¸°ì¤€ì— ë§ì¶¤)

const DAYS\_OF\_WEEK \= \[

  { id: 0, label: 'ì¼' },

  { id: 1, label: 'ì›”' },

  { id: 2, label: 'í™”' },

  { id: 3, label: 'ìˆ˜' },

  { id: 4, label: 'ëª©' },

  { id: 5, label: 'ê¸ˆ' },

  { id: 6, label: 'í† ' },

\];

export default function AlarmSettingScreen({ onSaveAlarm }) {

  // 1\. ìƒíƒœ ê´€ë¦¬: ì‹œê°„ê³¼ ìš”ì¼

  const \[date, setDate\] \= useState(new Date()); // í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì´ˆê¸°í™”

  const \[selectedDays, setSelectedDays\] \= useState(\[1, 2, 3, 4, 5\]); // ê¸°ë³¸ê°’: í‰ì¼(ì›”\~ê¸ˆ) í™œì„±í™”

  // 2\. ìš”ì¼ í† ê¸€ í•¨ìˆ˜

  const toggleDay \= (dayId) \=\> {

    setSelectedDays((prevDays) \=\> {

      if (prevDays.includes(dayId)) {

        // ì´ë¯¸ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ ì œê±° (ì„ íƒ í•´ì œ)

        return prevDays.filter(id \=\> id \!== dayId);

      } else {

        // ì„ íƒë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ ì¶”ê°€í•˜ê³  ìš”ì¼ ìˆœì„œëŒ€ë¡œ ì •ë ¬

        return \[...prevDays, dayId\].sort();

      }

    });

  };

  // 3\. ì•ŒëŒ ì €ì¥ ë²„íŠ¼ í•¸ë“¤ëŸ¬

  const handleSave \= () \=\> {

    if (selectedDays.length \=== 0) {

      Alert.alert('ì•Œë¦¼', 'ìµœì†Œ í•˜ë£¨ ì´ìƒì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');

      return;

    }

    const hour \= date.getHours();

    const minute \= date.getMinutes();

    console.log(\`ì„¤ì •ëœ ì•ŒëŒ ì‹œê°„: ${hour}ì‹œ ${minute}ë¶„\`);

    console.log(\`ì„ íƒëœ ìš”ì¼ ID: ${selectedDays}\`);

    // ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸(App.js ë“±)ë¡œ ì„¤ì •ëœ ë°ì´í„° ì „ë‹¬

    if (onSaveAlarm) {

      onSaveAlarm(hour, minute, selectedDays);

    }

  };

  return (

    \<View style\={styles.container}\>

      \<Text style\={styles.headerTitle}\>ì•ŒëŒ ì‹œê°„ ì„¤ì •\</Text\>

      {/\* â° ìœ„ì•„ë˜ ìŠ¤í¬ë¡¤ íœ  íƒ€ì„í”¼ì»¤ \*/}

      \<View style\={styles.pickerContainer}\>

        \<DatePicker

          date\={date}

          onDateChange\={setDate}

          mode\="time" // ì‹œê°„ë§Œ ì„ íƒí•˜ëŠ” ëª¨ë“œ

          locale\="ko-KR" // ì˜¤ì „/ì˜¤í›„ í•œê¸€ í‘œì‹œ

          theme\="light" // ë‹¤í¬ëª¨ë“œ ë°©ì§€ìš© ê°•ì œ ë¼ì´íŠ¸ í…Œë§ˆ (í•„ìš”ì‹œ ì œê±°)

          minuteInterval\={1} // 1ë¶„ ë‹¨ìœ„ ìŠ¤í¬ë¡¤

        /\>

      \</View\>

      {/\* ğŸ“… ìš”ì¼ ì„ íƒ ë²„íŠ¼ ëª¨ìŒ \*/}

      \<View style\={styles.daysContainer}\>

        {DAYS\_OF\_WEEK.map((day) \=\> {

          const isSelected \= selectedDays.includes(day.id);

          // ì¼ìš”ì¼(0)ê³¼ í† ìš”ì¼(6)ì€ ê¸€ì ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ ì£¼ê¸° ìœ„í•œ ì²˜ë¦¬

          const textColor \= day.id \=== 0 ? '\#FF3B30' : day.id \=== 6 ? '\#007AFF' : '\#333';

          return (

            \<TouchableOpacity

              key\={day.id}

              style\={\[

                styles.dayButton,

                isSelected ? styles.dayButtonSelected : null,

              \]}

              onPress\={() \=\> toggleDay(day.id)}

            \>

              \<Text style\={\[

                styles.dayText,

                { color: isSelected ? '\#FFF' : textColor },

              \]}\>

                {day.label}

              \</Text\>

            \</TouchableOpacity\>

          );

        })}

      \</View\>

      {/\* ğŸ’¾ ì €ì¥ ë²„íŠ¼ \*/}

      \<TouchableOpacity style\={styles.saveButton} onPress\={handleSave}\>

        \<Text style\={styles.saveButtonText}\>ì €ì¥í•˜ê¸°\</Text\>

      \</TouchableOpacity\>

    \</View\>

  );

}

// ğŸ¨ ìŠ¤íƒ€ì¼ë§

const styles \= StyleSheet.create({

  container: {

    flex: 1,

    backgroundColor: '\#F9F9F9',

    alignItems: 'center',

    paddingTop: 50,

  },

  headerTitle: {

    fontSize: 22,

    fontWeight: 'bold',

    marginBottom: 30,

    color: '\#333',

  },

  pickerContainer: {

    backgroundColor: '\#FFF',

    borderRadius: 20,

    padding: 10,

    shadowColor: '\#000',

    shadowOpacity: 0.1,

    shadowRadius: 10,

    elevation: 5,

    marginBottom: 40,

  },

  daysContainer: {

    flexDirection: 'row',

    justifyContent: 'center',

    marginBottom: 40,

    width: '100%',

    paddingHorizontal: 20,

  },

  dayButton: {

    width: 40,

    height: 40,

    borderRadius: 20,

    backgroundColor: '\#E5E5EA',

    justifyContent: 'center',

    alignItems: 'center',

    marginHorizontal: 4,

  },

  dayButtonSelected: {

    backgroundColor: '\#34C759', // í™œì„±í™” ì‹œ ì´ˆë¡ìƒ‰ ë°°ê²½

  },

  dayText: {

    fontSize: 16,

    fontWeight: '600',

  },

  saveButton: {

    backgroundColor: '\#000',

    paddingVertical: 15,

    paddingHorizontal: 60,

    borderRadius: 30,

  },

  saveButtonText: {

    color: '\#FFF',

    fontSize: 18,

    fontWeight: 'bold',

  },

});

---

### **ğŸ”— 3\. UIì™€ ì•ŒëŒ ë§¤ë‹ˆì € í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°**

ì´ì œ ë§Œë“¤ì–´ì§„ í™”ë©´(AlarmSettingScreen.js)ì„ ê¸°ì¡´ì˜ ì•ŒëŒ ë“±ë¡ ë¡œì§ê³¼ ì—°ê²°í•´ ì£¼ë©´, ì‚¬ìš©ìê°€ í™”ë©´ì—ì„œ ì„ íƒí•œ ì‹œê°„ê³¼ ìš”ì¼ì´ ì‹¤ì œ Notifee ë°±ê·¸ë¼ìš´ë“œ ì•ŒëŒìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.

ì•ì„œ ì‘ì„±í–ˆë˜ "íŠ¹ì • ìš”ì¼ì— ë§¤ì£¼ ë°˜ë³µë˜ëŠ” ì•ŒëŒì„ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜(scheduleWeeklyAlarms)"ë¥¼ ê¸°ì–µí•˜ì‹œë‚˜ìš”? UIì—ì„œ ì¶”ì¶œí•œ ë°ì´í„°(hour, minute, selectedDays)ë¥¼ ê·¸ í•¨ìˆ˜ì— ë„˜ê²¨ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

App.jsì—ì„œ ì´ í™”ë©´ì„ ë¶ˆëŸ¬ì™€ ì—°ê²°í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

JavaScript

import React from 'react';

import { View, Alert } from 'react-native';

import AlarmSettingScreen from './src/AlarmSettingScreen';

// ì•ì„œ ë§Œë“¤ì—ˆë˜ ìš”ì¼ë³„ ë°˜ë³µ ì•ŒëŒ ë“±ë¡ í•¨ìˆ˜ ë° ë¡œì»¬ íŒŒì¼ ì„ íƒ ë¡œì§ ì„í¬íŠ¸

// import { createUnifiedWeeklyAlarm } from './src/AlarmManager'; 

export default function App() {

  const handleSaveAlarm \= async (hour, minute, days) \=\> {

    // 1\. ì—¬ê¸°ì„œ ì‚¬ìš©ìê°€ ì„¤ì •í•œ íŒŒì¼ ëª©ë¡(Firebase \+ ê°œì¸ íŒŒì¼)ì„ êµ¬ì„±í•©ë‹ˆë‹¤.

    const myPlaylist \= \[

      'gs://my-alarm-5fb86.firebasestorage.app/wakeup-sound.wav',

      // ... ì¶”ê°€ íŒŒì¼ë“¤

    \];

    // 2\. ì•ŒëŒ ë§¤ë‹ˆì €ì—ê²Œ ìŠ¤ì¼€ì¤„ë§ì„ ìš”ì²­í•©ë‹ˆë‹¤. (ì´ì „ ë‹¨ê³„ì—ì„œ ë§Œë“  í•¨ìˆ˜ í™œìš©)

    // await createUnifiedWeeklyAlarm(hour, minute, days, 'custom\_alarm\_1', myPlaylist);

    Alert.alert(

      'ì•ŒëŒ ì„¤ì • ì™„ë£Œ\!',

      \`${hour}ì‹œ ${minute}ë¶„ ì•ŒëŒì´ ì„ íƒí•œ ìš”ì¼ì— ë°˜ë³µë˜ë„ë¡ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\`

    );

  };

  return (

    \<View style\={{ flex: 1 }}\>

      {/\* ì•ŒëŒ ì„¤ì • í™”ë©´ ë Œë”ë§ \*/}

      \<AlarmSettingScreen onSaveAlarm\={handleSaveAlarm} /\>

    \</View\>

  );

}

ì´ë ‡ê²Œ í•˜ë©´ iOSì™€ ì•ˆë“œë¡œì´ë“œ ëª¨ë‘ì—ì„œ ë¶€ë“œëŸ½ê²Œ ëŒì•„ê°€ëŠ” ì§ê´€ì ì¸ íœ  íƒ€ì´ë¨¸ì™€ ìš”ì¼ ì„ íƒ ë²„íŠ¼ì´ ì™„ì„±ë©ë‹ˆë‹¤.

